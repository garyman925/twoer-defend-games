<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å¡”å¡ç‰‡ç³»çµ±æ¸¬è©¦</title>
    <style>
        body {
            margin: 0;
            padding: 20px;
            background: #222;
            color: white;
            font-family: Arial, sans-serif;
        }
        #game-container {
            border: 2px solid #444;
            margin: 20px 0;
        }
        .info {
            background: #333;
            padding: 10px;
            margin: 10px 0;
            border-radius: 5px;
        }
        .controls {
            background: #444;
            padding: 10px;
            margin: 10px 0;
            border-radius: 5px;
        }
        button {
            background: #666;
            color: white;
            border: 1px solid #888;
            padding: 8px 16px;
            margin: 5px;
            border-radius: 4px;
            cursor: pointer;
        }
        button:hover {
            background: #777;
        }
    </style>
</head>
<body>
    <h1>å¡”å¡ç‰‡ç³»çµ±æ¸¬è©¦</h1>
    
    <div class="info">
        <h3>æ¸¬è©¦åŠŸèƒ½ï¼š</h3>
        <ul>
            <li>âœ… åº•éƒ¨å¡”å¡ç‰‡é¸æ“‡å€åŸŸ</li>
            <li>âœ… å¡ç‰‡ hover æ•ˆæœï¼ˆæ”¾å¤§ã€ä¸Šç§»ï¼‰</li>
            <li>âœ… å¡ç‰‡é¸ä¸­é«˜äº®ï¼ˆç¶ è‰²é‚Šæ¡†ï¼‰</li>
            <li>âœ… é»æ“Šå¡ç‰‡é–‹å§‹å¡”æ”¾ç½®æ¨¡å¼</li>
            <li>âœ… é‡‘éŒ¢ç³»çµ±é›†æˆ</li>
            <li>âœ… å¡ç‰‡å¯ç”¨æ€§æ›´æ–°ï¼ˆåŸºæ–¼é‡‘éŒ¢ï¼‰</li>
        </ul>
    </div>

    <div class="controls">
        <h3>æ¸¬è©¦æ§åˆ¶ï¼š</h3>
        <button onclick="addMoney(100)">+100 é‡‘éŒ¢</button>
        <button onclick="addMoney(500)">+500 é‡‘éŒ¢</button>
        <button onclick="spendMoney(200)">-200 é‡‘éŒ¢</button>
        <button onclick="resetMoney()">é‡ç½®é‡‘éŒ¢</button>
        <button onclick="toggleCards()">åˆ‡æ›å¡ç‰‡é¡¯ç¤º</button>
    </div>

    <div id="game-container"></div>

    <div class="info">
        <h3>æ“ä½œèªªæ˜ï¼š</h3>
        <ul>
            <li>ğŸ–±ï¸ å°‡æ»‘é¼ æ‡¸åœåœ¨å¡ç‰‡ä¸ŠæŸ¥çœ‹ hover æ•ˆæœ</li>
            <li>ğŸ–±ï¸ é»æ“Šå¡ç‰‡é¸æ“‡å¡”é¡å‹</li>
            <li>ğŸ–±ï¸ åœ¨åœ°åœ–ä¸Šé»æ“Šæ”¾ç½®å¡”</li>
            <li>âŒ¨ï¸ æŒ‰ ESC å–æ¶ˆæ”¾ç½®</li>
            <li>ğŸ’° ä½¿ç”¨ä¸Šæ–¹æŒ‰éˆ•æ¸¬è©¦é‡‘éŒ¢ç³»çµ±</li>
        </ul>
    </div>

    <script src="node_modules/phaser/dist/phaser.min.js"></script>
    <script>
        // æ¨¡æ“¬ç©å®¶é‡‘éŒ¢
        let playerMoney = 1000;
        
        // é‡‘éŒ¢æ§åˆ¶å‡½æ•¸
        function addMoney(amount) {
            playerMoney += amount;
            updateMoneyDisplay();
            if (window.game && window.game.scene && window.game.scene.scenes[0] && window.game.scene.scenes[0].towerCardUI) {
                window.game.scene.scenes[0].towerCardUI.updateCardAvailability(playerMoney);
            }
        }
        
        function spendMoney(amount) {
            playerMoney = Math.max(0, playerMoney - amount);
            updateMoneyDisplay();
            if (window.game && window.game.scene && window.game.scene.scenes[0] && window.game.scene.scenes[0].towerCardUI) {
                window.game.scene.scenes[0].towerCardUI.updateCardAvailability(playerMoney);
            }
        }
        
        function resetMoney() {
            playerMoney = 1000;
            updateMoneyDisplay();
            if (window.game && window.game.scene && window.game.scene.scenes[0] && window.game.scene.scenes[0].towerCardUI) {
                window.game.scene.scenes[0].towerCardUI.updateCardAvailability(playerMoney);
            }
        }
        
        function updateMoneyDisplay() {
            const moneyDisplay = document.getElementById('money-display');
            if (moneyDisplay) {
                moneyDisplay.textContent = `é‡‘éŒ¢: $${playerMoney}`;
            }
        }
        
        function toggleCards() {
            if (window.game && window.game.scene && window.game.scene.scenes[0] && window.game.scene.scenes[0].towerCardUI) {
                const cards = window.game.scene.scenes[0].towerCardUI.cards;
                cards.forEach(card => {
                    card.container.setVisible(!card.container.visible);
                });
            }
        }

        class TowerCardTestScene extends Phaser.Scene {
            constructor() {
                super({ key: 'TowerCardTestScene' });
                this.towerCardUI = null;
                this.player = { money: playerMoney };
            }

            preload() {
                console.log('ğŸ”„ é–‹å§‹åŠ è¼‰è³‡æº...');
                
                // åŠ è¼‰å¡”ç²¾éˆåœ–é›†
                this.load.atlas('tower-sprites', 'assets/sprites/towers/tower-sprite.png', 'assets/sprites/towers/tower-sprite.json');
                
                console.log('ğŸ“ è³‡æºåŠ è¼‰å®Œæˆ');
            }

            create() {
                console.log('ğŸ® é–‹å§‹å‰µå»ºå ´æ™¯...');
                
                // å‰µå»ºç°¡å–®çš„èƒŒæ™¯
                this.add.rectangle(640, 400, 1280, 800, 0x2c3e50);
                
                // å‰µå»ºå¡”å¡ç‰‡UI
                this.towerCardUI = new TowerCardUITest(this);
                this.towerCardUI.create();
                
                // è¨­ç½®äº‹ä»¶ç›£è½
                this.events.on('towerCardSelected', this.onTowerCardSelected, this);
                
                // å‰µå»ºé‡‘éŒ¢é¡¯ç¤º
                this.createMoneyDisplay();
                
                console.log('âœ… å ´æ™¯å‰µå»ºå®Œæˆ');
            }
            
            createMoneyDisplay() {
                const moneyText = this.add.text(20, 20, `é‡‘éŒ¢: $${this.player.money}`, {
                    fontSize: '24px',
                    fill: '#ffd93d',
                    fontWeight: 'bold',
                    backgroundColor: '#000000',
                    padding: { x: 10, y: 5 }
                });
                moneyText.setDepth(2000);
                
                // å°‡å…ƒç´ æ·»åŠ åˆ° DOM ä»¥ä¾¿å¤–éƒ¨æ§åˆ¶
                const moneyElement = document.createElement('div');
                moneyElement.id = 'money-display';
                moneyElement.textContent = `é‡‘éŒ¢: $${this.player.money}`;
                moneyElement.style.position = 'absolute';
                moneyElement.style.top = '20px';
                moneyElement.style.left = '20px';
                moneyElement.style.color = '#ffd93d';
                moneyElement.style.fontSize = '18px';
                moneyElement.style.fontWeight = 'bold';
                moneyElement.style.backgroundColor = 'rgba(0,0,0,0.7)';
                moneyElement.style.padding = '5px 10px';
                moneyElement.style.borderRadius = '5px';
                document.body.appendChild(moneyElement);
            }
            
            onTowerCardSelected(data) {
                const { type, name, cost } = data;
                console.log(`ğŸ¯ é¸æ“‡äº†å¡”å¡ç‰‡: ${name} (${type}) - åƒ¹æ ¼: $${cost}`);
                
                if (this.player.money >= cost) {
                    console.log(`âœ… é–‹å§‹æ”¾ç½® ${type} å¡”`);
                    // é€™è£¡å¯ä»¥æ·»åŠ å¡”æ”¾ç½®é‚è¼¯
                } else {
                    console.warn(`âŒ é‡‘éŒ¢ä¸è¶³ï¼Œç„¡æ³•è³¼è²· ${name} (éœ€è¦ $${cost})`);
                }
            }
        }

        // ç°¡åŒ–ç‰ˆçš„ TowerCardUI ç”¨æ–¼æ¸¬è©¦
        class TowerCardUITest {
            constructor(scene) {
                this.scene = scene;
                this.cards = [];
                this.selectedCard = null;
                this.cardSpacing = 20;
                this.cardWidth = 97;
                this.cardHeight = 129;
                this.uiHeight = 130;
                
                this.towerTypes = [
                    { type: 'basic', name: 'åŸºç¤å¡”', cardFrame: 'basic-tower-card.png', cost: 50 },
                    { type: 'cannon', name: 'åŠ è¾²ç‚®', cardFrame: 'canon-tower-card.png', cost: 100 },
                    { type: 'laser', name: 'æ¿€å…‰å¡”', cardFrame: 'laser-tower-card.png', cost: 150 },
                    { type: 'ice', name: 'å†°å‡å¡”', cardFrame: 'ice-tower-card.png', cost: 120 }
                ];
            }

            create() {
                console.log('ğŸ´ å‰µå»ºå¡”å¡ç‰‡é¸æ“‡å€åŸŸ...');
                
                const { width, height } = this.scene.scale.gameSize;
                const startX = this.cardSpacing;
                const cardY = height - this.uiHeight + (this.uiHeight - this.cardHeight) / 2;
                
                // å‰µå»ºèƒŒæ™¯
                this.createBackground(width, height);
                
                // å‰µå»ºæ¯å€‹å¡”å¡ç‰‡
                this.towerTypes.forEach((towerConfig, index) => {
                    const cardX = startX + index * (this.cardWidth + this.cardSpacing);
                    const card = this.createTowerCard(cardX, cardY, towerConfig, index);
                    this.cards.push(card);
                });
                
                console.log(`âœ… å‰µå»ºäº† ${this.cards.length} å€‹å¡”å¡ç‰‡`);
            }

            createBackground(width, height) {
                this.background = this.scene.add.rectangle(
                    width / 2, 
                    height - this.uiHeight / 2, 
                    width, 
                    this.uiHeight, 
                    0x000000, 
                    0.8
                );
                this.background.setDepth(1000);
                
                this.border = this.scene.add.rectangle(
                    width / 2,
                    height - this.uiHeight,
                    width,
                    2,
                    0x444444
                );
                this.border.setDepth(1001);
            }

            createTowerCard(x, y, towerConfig, index) {
                const card = {
                    type: towerConfig.type,
                    name: towerConfig.name,
                    cost: towerConfig.cost,
                    cardFrame: towerConfig.cardFrame,
                    index: index,
                    container: null,
                    sprite: null,
                    shadow: null,
                    highlight: null,
                    costText: null,
                    isSelected: false
                };

                card.container = this.scene.add.container(x, y);
                card.container.setDepth(1002);
                card.container.setSize(this.cardWidth, this.cardHeight);
                card.container.setInteractive();

                // é™°å½±
                card.shadow = this.scene.add.rectangle(2, 2, this.cardWidth, this.cardHeight, 0x000000, 0.3);
                card.shadow.setOrigin(0.5);
                card.container.add(card.shadow);

                // å¡ç‰‡ç²¾éˆ
                card.sprite = this.scene.add.image(0, 0, 'tower-sprites', card.cardFrame);
                card.sprite.setOrigin(0.5);
                card.container.add(card.sprite);

                // é«˜äº®æ•ˆæœ
                card.highlight = this.scene.add.rectangle(0, 0, this.cardWidth + 8, this.cardHeight + 8, 0x00ff00, 0);
                card.highlight.setStrokeStyle(3, 0x00ff00, 0.8);
                card.highlight.setOrigin(0.5);
                card.highlight.setVisible(false);
                card.container.add(card.highlight);

                // åƒ¹æ ¼æ–‡å­—
                card.costText = this.scene.add.text(0, this.cardHeight / 2 - 10, `$${card.cost}`, {
                    fontSize: '14px',
                    fill: '#ffd93d',
                    fontWeight: 'bold',
                    backgroundColor: '#000000',
                    padding: { x: 4, y: 2 }
                });
                card.costText.setOrigin(0.5);
                card.container.add(card.costText);

                // äº¤äº’äº‹ä»¶
                this.addCardInteractions(card);

                return card;
            }

            addCardInteractions(card) {
                card.container.on('pointerover', () => {
                    if (!card.isSelected) {
                        card.sprite.setScale(1.1);
                        card.shadow.setScale(1.1);
                        card.container.y -= 5;
                    }
                });

                card.container.on('pointerout', () => {
                    if (!card.isSelected) {
                        card.sprite.setScale(1.0);
                        card.shadow.setScale(1.0);
                        card.container.y += 5;
                    }
                });

                card.container.on('pointerdown', () => {
                    this.selectCard(card);
                });
            }

            selectCard(selectedCard) {
                if (this.selectedCard) {
                    this.deselectCard(this.selectedCard);
                }

                selectedCard.isSelected = true;
                selectedCard.highlight.setVisible(true);
                selectedCard.sprite.setScale(1.1);
                selectedCard.shadow.setScale(1.1);
                selectedCard.container.y -= 5;

                this.selectedCard = selectedCard;

                console.log(`ğŸ¯ é¸æ“‡äº†å¡”: ${selectedCard.name} (${selectedCard.type})`);

                this.scene.events.emit('towerCardSelected', {
                    type: selectedCard.type,
                    name: selectedCard.name,
                    cost: selectedCard.cost
                });
            }

            deselectCard(card) {
                card.isSelected = false;
                card.highlight.setVisible(false);
                card.sprite.setScale(1.0);
                card.shadow.setScale(1.0);
                card.container.y += 5;
            }

            deselectAll() {
                if (this.selectedCard) {
                    this.deselectCard(this.selectedCard);
                    this.selectedCard = null;
                }
            }

            updateCardAvailability(playerMoney) {
                this.cards.forEach(card => {
                    const canAfford = playerMoney >= card.cost;
                    card.sprite.setAlpha(canAfford ? 1.0 : 0.5);
                    card.costText.setAlpha(canAfford ? 1.0 : 0.5);
                    
                    if (!canAfford && card.isSelected) {
                        this.deselectAll();
                    }
                });
            }
        }

        const config = {
            type: Phaser.AUTO,
            width: 1280,
            height: 962,
            parent: 'game-container',
            backgroundColor: '#2c3e50',
            scene: TowerCardTestScene
        };

        const game = new Phaser.Game(config);
        window.game = game;
    </script>
</body>
</html>
