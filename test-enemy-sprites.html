<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ•µäººåœ–ç‰‡æ¸¬è©¦</title>
    <style>
        body {
            margin: 0;
            padding: 20px;
            background: #1a1a1a;
            color: white;
            font-family: Arial, sans-serif;
        }
        #game-container {
            border: 2px solid #333;
            margin: 20px auto;
            display: block;
        }
        .info {
            text-align: center;
            margin: 20px;
        }
        .controls {
            text-align: center;
            margin: 20px;
        }
        button {
            background: #4CAF50;
            color: white;
            border: none;
            padding: 10px 20px;
            margin: 5px;
            border-radius: 5px;
            cursor: pointer;
        }
        button:hover {
            background: #45a049;
        }
    </style>
</head>
<body>
    <div class="info">
        <h1>ğŸ® æ•µäººåœ–ç‰‡æ¸¬è©¦</h1>
        <p>æ¸¬è©¦æ•µäººåœ–ç‰‡æ˜¯å¦æ­£ç¢ºåŠ è¼‰å’Œé¡¯ç¤º</p>
    </div>

    <div class="controls">
        <button onclick="spawnEnemy('basic')">ç”ŸæˆåŸºç¤æ•µäºº</button>
        <button onclick="spawnEnemy('fast')">ç”Ÿæˆå¿«é€Ÿæ•µäºº</button>
        <button onclick="spawnEnemy('tank')">ç”Ÿæˆå¦å…‹æ•µäºº</button>
        <button onclick="spawnEnemy('flying')">ç”Ÿæˆé£›è¡Œæ•µäºº</button>
        <button onclick="spawnEnemy('boss')">ç”ŸæˆBossæ•µäºº</button>
        <button onclick="clearEnemies()">æ¸…é™¤æ‰€æœ‰æ•µäºº</button>
    </div>

    <script src="node_modules/phaser/dist/phaser.min.js"></script>
    <script>
        class EnemyTestScene extends Phaser.Scene {
            constructor() {
                super({ key: 'EnemyTestScene' });
                this.enemies = [];
            }

            preload() {
                // è¼‰å…¥æ•µäººåœ–ç‰‡
                this.load.atlas('enemy-sprites', 'assets/sprites/enemies/enemy-sprite.png', 'assets/sprites/enemies/enemy-sprite.json');
                
                // è¼‰å…¥é€²åº¦æ¢
                this.load.on('progress', (progress) => {
                    console.log('è¼‰å…¥é€²åº¦:', Math.round(progress * 100) + '%');
                });
            }

            create() {
                console.log('âœ… æ•µäººåœ–ç‰‡æ¸¬è©¦å ´æ™¯å‰µå»ºå®Œæˆ');
                
                // å‰µå»ºèƒŒæ™¯
                this.add.rectangle(400, 300, 800, 600, 0x2a2a2a);
                
                // é¡¯ç¤ºå¯ç”¨å¹€
                this.showAvailableFrames();
                
                // å‰µå»ºèªªæ˜æ–‡å­—
                this.add.text(400, 50, 'æ•µäººåœ–ç‰‡æ¸¬è©¦ - é»æ“ŠæŒ‰éˆ•ç”Ÿæˆä¸åŒé¡å‹çš„æ•µäºº', {
                    fontSize: '18px',
                    fill: '#ffffff',
                    align: 'center'
                }).setOrigin(0.5);
            }

            showAvailableFrames() {
                // é¡¯ç¤ºå¯ç”¨çš„æ•µäººå¹€
                const frames = ['enemy-1.png', 'enemy-2.png'];
                frames.forEach((frame, index) => {
                    const x = 200 + index * 400;
                    const y = 150;
                    
                    // é¡¯ç¤ºå¹€åç¨±
                    this.add.text(x, y - 80, frame, {
                        fontSize: '16px',
                        fill: '#ffff00',
                        align: 'center'
                    }).setOrigin(0.5);
                    
                    // é¡¯ç¤ºåœ–ç‰‡
                    const sprite = this.add.image(x, y, 'enemy-sprites', frame);
                    sprite.setScale(0.4); // ç¨å¾®æ”¾å¤§é è¦½
                    sprite.setOrigin(0.5, 0.5);
                    
                    // é¡¯ç¤ºåŸå§‹å¤§å°ä¿¡æ¯
                    const frameData = this.textures.get('enemy-sprites').get(frame);
                    this.add.text(x, y + 80, `åŸå§‹: ${frameData.width}x${frameData.height}`, {
                        fontSize: '12px',
                        fill: '#cccccc',
                        align: 'center'
                    }).setOrigin(0.5);
                });
            }

            spawnEnemy(type) {
                const x = 100 + Math.random() * 600;
                const y = 300 + Math.random() * 200;
                
                const enemy = this.createEnemy(type, x, y);
                this.enemies.push(enemy);
                
                console.log(`ç”Ÿæˆ ${type} æ•µäººæ–¼ (${x}, ${y})`);
            }

            createEnemy(type, x, y) {
                // ç²å–æ•µäººé…ç½®
                const frameName = this.getEnemyFrameName(type);
                const scale = this.getEnemyScale(type);
                const size = this.getEnemySize(type);
                
                // å‰µå»ºæ•µäººåœ–ç‰‡
                const enemySprite = this.add.image(x, y, 'enemy-sprites', frameName);
                enemySprite.setScale(scale);
                enemySprite.setOrigin(0.5, 0.5);
                
                // å‰µå»ºè¡€æ¢
                const healthBarY = y - size - 12;
                const healthBarBg = this.add.rectangle(x, healthBarY, 30, 4, 0x330000);
                const healthBar = this.add.rectangle(x, healthBarY, 30, 4, 0xff0000);
                
                // å‰µå»ºé¡å‹æ¨™è­˜
                const typeIndicator = this.add.text(x, y, type[0].toUpperCase(), {
                    fontSize: '12px',
                    fill: '#ffffff',
                    align: 'center'
                }).setOrigin(0.5);
                
                // å‰µå»ºæ•µäººçµ„
                const enemyGroup = this.add.group();
                enemyGroup.add(enemySprite);
                enemyGroup.add(healthBarBg);
                enemyGroup.add(healthBar);
                enemyGroup.add(typeIndicator);
                
                // æ·»åŠ æ•µäººä¿¡æ¯
                enemyGroup.enemyType = type;
                enemyGroup.frameName = frameName;
                enemyGroup.scale = scale;
                
                return enemyGroup;
            }

            getEnemyFrameName(type) {
                const frameMap = {
                    'basic': 'enemy-1.png',
                    'fast': 'enemy-2.png',
                    'tank': 'enemy-1.png',
                    'flying': 'enemy-2.png',
                    'boss': 'enemy-1.png'
                };
                return frameMap[type] || 'enemy-1.png';
            }

            getEnemyScale(type) {
                const scaleMap = {
                    'basic': 0.35,   // åŸºç¤æ•µäººï¼šæ”¾å¤§75%
                    'fast': 0.25,    // å¿«é€Ÿæ•µäººï¼šæ”¾å¤§67%
                    'tank': 0.5,     // å¦å…‹æ•µäººï¼šæ”¾å¤§67%
                    'flying': 0.3,   // é£›è¡Œæ•µäººï¼šæ”¾å¤§67%
                    'boss': 0.6      // Bossæ•µäººï¼šæ”¾å¤§50%
                };
                return scaleMap[type] || 0.35;
            }

            getEnemySize(type) {
                const sizeMap = {
                    'basic': 12,
                    'fast': 10,
                    'tank': 18,
                    'flying': 14,
                    'boss': 25
                };
                return sizeMap[type] || 12;
            }

            clearEnemies() {
                this.enemies.forEach(enemy => {
                    enemy.destroy();
                });
                this.enemies = [];
                console.log('æ¸…é™¤æ‰€æœ‰æ•µäºº');
            }
        }

        // éŠæˆ²é…ç½®
        const config = {
            type: Phaser.AUTO,
            width: 800,
            height: 600,
            parent: 'game-container',
            backgroundColor: '#1a1a1a',
            scene: EnemyTestScene
        };

        // å‰µå»ºéŠæˆ²å¯¦ä¾‹
        const game = new Phaser.Game(config);

        // å…¨å±€å‡½æ•¸ä¾›æŒ‰éˆ•èª¿ç”¨
        function spawnEnemy(type) {
            game.scene.getScene('EnemyTestScene').spawnEnemy(type);
        }

        function clearEnemies() {
            game.scene.getScene('EnemyTestScene').clearEnemies();
        }
    </script>
</body>
</html>
