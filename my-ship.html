<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ÊàëÁöÑÊà∞Ê©ü - Ë£ùÂÇôÁ≥ªÁµ±</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700;900&family=Squada+One&family=Noto+Sans+HK:wght@400;700;900&display=swap" rel="stylesheet">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Noto Sans HK', 'Arial', 'Microsoft JhengHei', sans-serif;
            background: #01332f url('assets/maps/space-bg.png') center center / cover no-repeat fixed;
            color: #ffffff;
            min-height: 100vh;
            overflow: auto;
            padding: 20px;
            display: flex;
            justify-content: center;
            align-items: center;
        }

        /* ‰∏ªÂÆπÂô® - 12ÂàóÁ∂≤Ê†ºÁ≥ªÁµ± */
        .main-container {
            width: 100%;
            max-width: 1200px;
            height: auto;
            min-height: 900px;
            display: grid;
            grid-template-rows: auto 1fr 1fr;
            grid-template-columns: repeat(12, 1fr);
            gap: 0;
            margin: 0 auto;
            border-radius: 12px;
            overflow: hidden;
            box-sizing: border-box;
        }

        /* È†ÇÈÉ®Ê®ôÈ°åÂçÄ - Ë∑®Ë∂äÊâÄÊúâÂàó */
        .header-bar {
            grid-column: 1 / -1;
            background: transparent;
            padding: 20px;
            display: flex;
            justify-content: center;
            align-items: center;
            position: relative;
            box-sizing: border-box;
            overflow: hidden;
        }

            .header-bar .header-title .header-stoke-left{
                position: absolute;
                left: 0;
                width: 50%;
                height: 1px;
                background: aquamarine;
                transform: translate(-100%, 19px);
            }

            .header-bar .header-title .header-stoke-right{
                position: absolute;
                right: 0;
                width: 50%;
                height: 1px;
                background: aquamarine;
                transform: translate(100%, -19px);
            }

        .header-title {
            position: relative;
            background-image: url(assets/export/heading-frame.png);
            background-size: cover;
            background-position: center;
            background-repeat: no-repeat;
            border: none;
            border-radius: 0;
            padding: 15px 12%;
            max-width: 95%;
            font-family: 'Noto Sans HK', 'Squada One', cursive;
            font-size: 1.6rem;
            font-weight: bold;
            color: #b0fffa;
            letter-spacing: 7px;
            box-sizing: border-box;
        }

        .close-btn {
            position: absolute;
            right: 20px;
            top: 50%;
            transform: translateY(-50%);
            width: 40px;
            height: 40px;
            background: transparent;
            border: 2px solid #00ffff;
            border-radius: 4px;
            color: #ffffff;
            font-size: 1.5rem;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .close-btn:hover {
            background: rgba(255, 0, 0, 0.3);
            border-color: #ff0000;
            transform: translateY(-50%) scale(1.1);
        }

        /* Â∑¶‰∏äÂçÄ - MY AIR PLANE */
        .plane-info {
            grid-column: span 5;
            grid-row: 2;
            padding: 30px;
            display: flex;
            flex-direction: column;
            gap: 20px;
            box-sizing: border-box;
            overflow: hidden;
        }

        .section-title {
            font-family: 'Orbitron', monospace;
            font-size: 1.6rem;
            font-weight: 900;
            color: #ffffff;
            letter-spacing: 4px;
            text-transform: uppercase;
            margin-bottom: 10px;
            text-shadow: 0 0 20px rgba(0, 255, 255, 0.5);
        }

        .section-title-large {
            font-family: 'Orbitron', monospace;
            font-size: 2.5rem;
            font-weight: 900;
            color: #ffffff;
            letter-spacing: 4px;
            text-transform: uppercase;
            margin-bottom: 10px;
            text-shadow: 0 0 20px rgba(0, 255, 255, 0.5);
        }

        .change-name-btn {
            width: fit-content;
            padding: 8px 20px;
            background: #ffac10;
            border: 2px solid #ffffff;
            border-radius: 4px;
            color: #040404;
            font-family: 'Orbitron', monospace;
            font-size: 0.9rem;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.3s ease;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .change-name-btn:hover {
            background: rgba(255, 255, 255, 0.1);
            border-color: #00ffff;
            color: #00ffff;
        }
        


        .my-ship-name { 
            font-family: 'Orbitron', monospace;
            font-size: 1.6rem;
            font-weight: 900;
            color: #ffffff;
            letter-spacing: 4px;
            text-transform: uppercase;
            padding: 18px;
            background: linear-gradient(0deg, #053d43, #00000000);
            border: 2px solid #49fff575;
            border-radius: 10px;
            max-width: 100%;
            box-sizing: border-box;
            word-break: break-word;
        }

        .my-ship-name:hover {
            color: #ffd93d;
            cursor: pointer;
        }

        /* üÜï Â∞èÊ®ôÈ°åÊ®£Âºè */
        .small-title {
            font-family: 'Orbitron', monospace;
            font-size: 0.9rem;
            font-weight: 700;
            color: #00ffff;
            text-transform: uppercase;
            letter-spacing: 2px;
            opacity: 0.8;
        }

        /* üÜï Êà∞Ê©üÂêçÁ®±ÂçÄÂ°ä */
        .ship-name-section {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        /* üÜï ÂçáÁ¥öÊäÄËÉΩÂçÄÂ°ä */
        .upgrade-skill-section {
            display: flex;
            flex-direction: column;
            gap: 15px;
            padding: 25px;
            background: rgba(0, 255, 255, 0.05);
            border: 2px solid rgba(0, 255, 255, 0.3);
            border-radius: 8px;
        }

        /* Â±¨ÊÄßÈÄ≤Â∫¶Ê¢ù */
        .attribute-row {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .attribute-icon {
            font-size: 40px;
            width: 50px;
            height: 50px;
            display: flex;
            align-items: center;
            justify-content: center;
            filter: drop-shadow(0 0 10px rgba(0, 255, 255, 0.6));
        }

        .attribute-content {
            flex: 1;
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .attribute-label {
            font-family: 'Orbitron', monospace;
            font-size: 1rem;
            font-weight: 700;
            color: #ffffff;
            text-transform: uppercase;
            letter-spacing: 2px;
        }

        .progress-container {
            display: flex;
            gap: 8px;
            align-items: center;
        }

        .progress-blocks {
            display: flex;
            gap: 4px;
            max-width: 100%;
            flex-wrap: wrap;
        }

        .progress-block {
            width: 30px;
            height: 20px;
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.3);
            border-radius: 2px;
            transition: all 0.3s ease;
        }

        .progress-block.active.health {
            background: linear-gradient(135deg, #00ff88 0%, #00cc66 100%);
            border-color: #00ff88;
            box-shadow: 0 0 10px rgba(0, 255, 136, 0.6);
        }

        .progress-block.active.speed {
            background: linear-gradient(135deg, #ff6600 0%, #ff4400 100%);
            border-color: #ff6600;
            box-shadow: 0 0 10px rgba(255, 102, 0, 0.6);
        }

        .upgrade-plus-btn {
            width: 35px;
            height: 35px;
            background: linear-gradient(135deg, #00ffff 0%, #009fb9 100%);
            border: none;
            border-radius: 4px;
            color: #000000;
            font-size: 1.5rem;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 0 15px rgba(0, 255, 255, 0.4);
        }

        .upgrade-plus-btn:hover:not(:disabled) {
            transform: scale(1.1);
            box-shadow: 0 0 25px rgba(0, 255, 255, 0.8);
        }

        .upgrade-plus-btn:disabled {
            background: rgba(100, 100, 100, 0.3);
            color: #555555;
            cursor: not-allowed;
            box-shadow: none;
        }

        /* Âè≥‰∏äÂçÄ - Êà∞Ê©üÂúñÁâá */
        .plane-visual {
            grid-column: span 7;
            grid-row: 2;
            padding: 30px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            gap: 20px;
            box-sizing: border-box;
            overflow: hidden;
        }

        .plane-image-container {
            flex: 1;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .plane-image {
            max-width: 100%;
            max-height: 350px;
            width: auto;
            height: auto;
            filter: drop-shadow(0 0 30px rgba(0, 255, 255, 0.4));
            transition: all 0.3s ease;
        }

        .plane-image:hover {
            filter: drop-shadow(0 0 50px rgba(0, 255, 255, 0.8));
            transform: scale(1.05);
        }

        .plane-stats {
            display: flex;
            gap: 30px;
            padding: 20px;
            width: 100%;
            max-width: 100%;
            justify-content: space-evenly;
            box-sizing: border-box;
        }

        .plane-stat-item {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 5px;
        }

        .plane-stat-label {
            font-size: 0.85rem;
            color: #00ffff;
            font-family: 'Noto Sans HK', sans-serif;
        }

        .plane-stat-value {
            font-size: 1.3rem;
            font-weight: bold;
            color: #ffd93d;
            font-family: 'Orbitron', monospace;
        }

        /* Â∑¶‰∏ãÂçÄ - MY DEFEND TOWER */
        .tower-section {
            grid-column: span 6;
            grid-row: 3;
            padding: 30px;
            box-sizing: border-box;
            overflow: hidden;
        }

        /* Âè≥‰∏ãÂçÄ - MY WEAPONS */
        .weapons-section {
            grid-column: span 6;
            grid-row: 3;
            padding: 30px;
            box-sizing: border-box;
            overflow: hidden;
        }

        /* Ë£ÖÂ§áË¶ÅÊ±ÇÊèêÁ§∫ */
        .equipment-requirement {
            font-family: 'Orbitron', monospace;
            font-size: 0.95rem;
            color: #00ffff;
            margin-bottom: 15px;
            padding: 8px 15px;
            background: rgba(0, 159, 185, 0.1);
            border-left: 3px solid #00ffff;
            border-radius: 4px;
            transition: all 0.3s ease;
        }

        .equipment-requirement.warning {
            color: #ff6600;
            border-left-color: #ff6600;
            background: rgba(255, 102, 0, 0.1);
        }

        .equipment-requirement.valid {
            color: #00ff88;
            border-left-color: #00ff88;
            background: rgba(0, 255, 136, 0.1);
        }

        .start-game-btn:disabled {
            background: rgba(100, 100, 100, 0.5);
            cursor: not-allowed;
            opacity: 0.5;
            box-shadow: none;
        }

        .start-game-btn:disabled:hover {
            transform: none;
            background: rgba(100, 100, 100, 0.5);
            box-shadow: none;
        }

        /* ÊßΩ‰ΩçÁ∂≤Ê†º - 2Ë°åx4Âàó */
        .slots-grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            grid-template-rows: repeat(2, 1fr);
            gap: 12px;
            width: 100%;
            max-width: 100%;
            box-sizing: border-box;
        }

        .slot {
            aspect-ratio: 1;
            background: rgba(0, 159, 185, 0.05);
            border: 2px solid #009fb9;
            border-radius: 8px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.3s ease;
            position: relative;
            padding: 15px;
            box-sizing: border-box;
            overflow: visible;
        }

        .slot:hover {
            border-color: #00ffff;
            background: rgba(0, 255, 255, 0.1);
            transform: translateY(-3px);
            box-shadow: 0 5px 20px rgba(0, 255, 255, 0.3);
        }

        /* Â∑≤Ë£ùÂÇôÊßΩ‰ΩçÁöÑÁâπÊÆäÊ®£Âºè */
        .slot.equipped {
            border-color: #00ff88;
            box-shadow: 0 0 15px rgba(0, 255, 136, 0.3);
        }

        .slot.equipped:hover {
            border-color: #00ffff;
            box-shadow: 0 5px 20px rgba(0, 255, 255, 0.4);
        }

        /* Êú™Ë£ùÂÇô‰ΩÜÂèØÁî®ÁöÑÊßΩ‰Ωç */
        .slot.available {
            opacity: 0.6;
            border-color: #009fb9;
        }

        .slot.available:hover {
            opacity: 1;
            border-color: #00ffff;
        }

        .slot.empty {
            cursor: default;
            opacity: 0.4;
        }

        .slot.empty:hover {
            border-color: #009fb9;
            background: rgba(0, 159, 185, 0.05);
            transform: none;
            box-shadow: none;
            opacity: 0.4;
        }

        /* Tick Ê®ôË®ò - Â∑¶‰∏äËßí */
        .slot-tick {
            position: absolute;
            top: -8px;
            left: -8px;
            width: 28px;
            height: 28px;
            background: linear-gradient(135deg, #00ff88 0%, #00cc66 100%);
            border: 2px solid #ffffff;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 16px;
            color: #000000;
            font-weight: bold;
            box-shadow: 0 0 15px rgba(0, 255, 136, 0.8);
            z-index: 10;
        }

        /* Á©∫ÊßΩ‰ΩçËúÇÁ™©ÂúñÊ®ô */
        .slot-empty-icon {
            font-size: 50px;
            color: rgba(0, 255, 255, 0.2);
        }

        /* Â∑≤Ë£ùÂÇôÊßΩ‰Ωç */
        .slot-icon {
            font-size: 50px;
            margin-bottom: 10px;
            filter: drop-shadow(0 0 10px rgba(0, 255, 255, 0.5));
        }

        .slot-name {
            font-family: 'Orbitron', monospace;
            font-size: 0.85rem;
            font-weight: 700;
            color: #ffffff;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        /* Â∞çË©±Ê°ÜÊ®£Âºè */
        .dialog-overlay {
            display: none;
            position: fixed;
            inset: 0;
            background: rgba(0, 0, 0, 0.9);
            z-index: 1000;
            align-items: center;
            justify-content: center;
            backdrop-filter: blur(5px);
            opacity: 0;
            transition: opacity 0.3s ease;
        }

        .dialog-overlay.active {
            display: flex;
            animation: fadeIn 0.3s ease forwards;
        }

        .dialog-overlay.closing {
            animation: fadeOut 0.3s ease forwards;
        }

        /* Fade-in ÂãïÁï´ */
        @keyframes fadeIn {
            from {
                opacity: 0;
            }
            to {
                opacity: 1;
            }
        }

        /* Fade-out ÂãïÁï´ */
        @keyframes fadeOut {
            from {
                opacity: 1;
            }
            to {
                opacity: 0;
            }
        }

        .dialog-box {
            background: linear-gradient(135deg, #0a0e27 0%, #1a1f3a 100%);
            border: 3px solid #00ffff;
            border-radius: 16px;
            max-width: 450px;
            width: 90%;
            max-height: 80vh;
            overflow: hidden;
            display: flex;
            flex-direction: column;
            gap: 0;
            box-shadow: 0 0 50px rgba(0, 255, 255, 0.7);
            position: relative;
            animation: scaleIn 0.3s ease;
        }

        /* Dialog-box Á∏ÆÊîæÂãïÁï´ */
        @keyframes scaleIn {
            from {
                transform: scale(0.9);
                opacity: 0;
            }
            to {
                transform: scale(1);
                opacity: 1;
            }
        }

        .dialog-overlay.closing .dialog-box {
            animation: scaleOut 0.3s ease;
        }

        @keyframes scaleOut {
            from {
                transform: scale(1);
                opacity: 1;
            }
            to {
                transform: scale(0.9);
                opacity: 0;
            }
        }

        .dialog-header {
            padding: 20px;
            background: rgba(0, 159, 185, 0.2);
            border-bottom: 2px solid #009fb9;
            display: flex;
            justify-content: center;
            align-items: center;
        }

        .dialog-title {
            font-size: 1.5rem;
            color: #00ffff;
            font-family: 'Orbitron', monospace;
            font-weight: 700;
            text-transform: uppercase;
        }

        .dialog-close {
            position: absolute;
            top: 15px;
            right: 15px;
            z-index: 100;
            background: none;
            border: none;
            color: #ffffff;
            font-size: 1.5rem;
            cursor: pointer;
            width: 32px;
            height: 32px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 4px;
            transition: all 0.3s ease;
        }

        .dialog-close:hover {
            background: rgba(255, 0, 0, 0.3);
            transform: scale(1.1);
        }

        .dialog-content {
            padding: 20px;
            overflow-y: auto;
            flex: 1;
        }

        .option-item {
            background: rgba(0, 159, 185, 0.1);
            border: 2px solid #009fb9;
            border-radius: 12px;
            padding: 16px;
            margin-bottom: 12px;
            display: flex;
            align-items: center;
            gap: 16px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .option-item:hover {
            transform: translateX(5px);
            border-color: #00ffff;
            box-shadow: 0 4px 16px rgba(0, 255, 255, 0.3);
        }

        .option-item.selected {
            border-color: #ffd93d;
            background: rgba(255, 217, 61, 0.15);
            box-shadow: 0 0 20px rgba(255, 217, 61, 0.4);
        }

        .option-item.locked {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .option-icon {
            font-size: 40px;
            flex-shrink: 0;
        }

        .option-details {
            flex: 1;
        }

        .option-name {
            font-size: 1.2rem;
            font-weight: bold;
            color: #ffffff;
            margin-bottom: 4px;
            font-family: 'Orbitron', monospace;
        }

        .option-desc {
            font-size: 0.9rem;
            color: #a0a0a0;
            margin-bottom: 8px;
            font-family: 'Noto Sans HK', sans-serif;
        }

        .option-stats {
            display: flex;
            gap: 16px;
            flex-wrap: wrap;
            font-size: 0.85rem;
            color: #00ffff;
            font-family: 'Noto Sans HK', sans-serif;
        }

        .option-badge {
            background: rgba(255, 217, 61, 0.2);
            color: #ffd93d;
            padding: 4px 12px;
            border-radius: 12px;
            font-size: 0.85rem;
            font-weight: bold;
            border: 1px solid #ffd93d;
            font-family: 'Noto Sans HK', sans-serif;
        }

        .option-badge.locked {
            background: rgba(255, 0, 0, 0.2);
            color: #ff5555;
            border-color: #ff5555;
        }

        .dialog-footer {
            padding: 16px 20px;
            background: rgba(0, 0, 0, 0.4);
            border-top: 2px solid #009fb9;
            display: flex;
            gap: 12px;
            justify-content: center;
        }

        .dialog-btn {
            padding: 10px 24px;
            border: none;
            border-radius: 8px;
            font-size: 1rem;
            cursor: pointer;
            transition: all 0.3s ease;
            font-family: 'Noto Sans HK', 'Orbitron', monospace;
            font-weight: 700;
            text-transform: uppercase;
        }

        .dialog-btn-primary {
            background: linear-gradient(135deg, #00ffff 0%, #009fb9 100%);
            color: #000000;
            box-shadow: 0 0 20px rgba(0, 255, 255, 0.4);
        }

        .dialog-btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 25px rgba(0, 255, 255, 0.6);
        }

        .dialog-btn-secondary {
            background: rgba(100, 100, 100, 0.5);
            color: white;
            border: 2px solid #666666;
        }

        .dialog-btn-secondary:hover {
            background: rgba(150, 150, 150, 0.5);
            border-color: #999999;
        }

        /* üÜï Ë©≥ÊÉÖÈù¢ÊùøÊ®£Âºè */
        .detail-view {
            display: flex;
            flex-direction: column;
            gap: 20px;
        }

        .detail-icon {
            font-size: 80px;
            text-align: center;
            filter: drop-shadow(0 0 20px rgba(0, 255, 255, 0.6));
        }

        .detail-name-row {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 15px;
            margin-bottom: 15px;
        }

        .detail-name {
            font-family: 'Orbitron', monospace;
            font-size: 2rem;
            font-weight: 900;
            color: #00ffff;
            text-transform: uppercase;
            letter-spacing: 3px;
            margin-bottom: 0;
        }

        .detail-section {
            background: rgba(0, 159, 185, 0.1);
            border: 1px solid rgba(0, 255, 255, 0.3);
            border-radius: 8px;
            padding: 15px;
        }

        .detail-section-title {
            font-family: 'Orbitron', monospace;
            font-size: 1.1rem;
            font-weight: 700;
            color: #00ffff;
            margin-bottom: 12px;
            text-transform: uppercase;
        }

        .detail-desc {
            font-family: 'Noto Sans HK', sans-serif;
            font-size: 1rem;
            line-height: 1.6;
            color: #e0e0e0;
        }

        .detail-stats {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .detail-stat {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 8px 12px;
            background: rgba(0, 0, 0, 0.3);
            border-radius: 6px;
            font-family: 'Noto Sans HK', sans-serif;
        }

        .detail-stat .stat-value {
            font-family: 'Orbitron', monospace;
            font-size: 1.1rem;
            font-weight: 700;
            color: #ffd93d;
        }

        .detail-abilities {
            list-style: none;
            padding: 0;
            font-family: 'Noto Sans HK', sans-serif;
        }

        .detail-abilities li {
            padding: 6px 0;
            color: #00ff88;
            font-size: 0.95rem;
        }

        .detail-status {
            text-align: center;
            padding: 8px 16px;
            background: rgba(0, 255, 136, 0.1);
            border: 2px solid #00ff88;
            border-radius: 8px;
            font-family: 'Orbitron', monospace;
            font-weight: 700;
            font-size: 0.9rem;
            color: #00ff88;
            flex-shrink: 0;
            white-space: nowrap;
        }

        .detail-status.unequipped {
            background: rgba(255, 255, 255, 0.05);
            border-color: #666666;
            color: #999999;
        }

        /* ÂïÜÂ∫óÊåâÈàïÊ®£Âºè */
        .shop-btn {
            position: absolute;
            left: 20px;
            top: 50%;
            transform: translateY(-50%);
            padding: 10px 24px;
            background: linear-gradient(135deg, #ffd93d 0%, #ffac10 100%);
            border: 2px solid #ffffff;
            border-radius: 8px;
            color: #000000;
            font-size: 1rem;
            font-weight: 900;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 8px;
            font-family: 'Orbitron', monospace;
            box-shadow: 0 0 20px rgba(255, 217, 61, 0.4);
            z-index: 10;
        }

        .shop-btn:hover {
            transform: translateY(-50%) scale(1.05);
            box-shadow: 0 0 30px rgba(255, 217, 61, 0.8);
            background: linear-gradient(135deg, #ffed4e 0%, #ffc221 100%);
        }

        /* ÈüøÊáâÂºèË®≠Ë®à */
        
        /* Âπ≥ÊùøÂ∞∫ÂØ∏Ôºà1025-1400pxÔºâ*/
        @media (min-width: 1025px) and (max-width: 1400px) {
            .main-container {
                max-width: 1200px;
                min-height: 850px;
            }
            
            .plane-info,
            .plane-visual,
            .tower-section,
            .weapons-section {
                padding: 25px;
            }
            
            .section-title-large {
                font-size: 2.2rem;
            }
            
            .slots-grid {
                gap: 12px;
            }
        }

        /* Â∞èÁ≠ÜÈõª/Âπ≥ÊùøÊ©´ÂêëÔºà769px - 1024pxÔºâ*/
        @media (max-width: 1024px) {
            body {
                padding: 10px;
                align-items: flex-start;
            }

            .main-container {
                grid-template-columns: 1fr;
                grid-template-rows: auto auto auto auto auto;
                min-height: auto;
            }

            .header-bar {
                grid-column: 1 / -1;
                grid-row: 1;
            }

            .plane-info {
                grid-column: 1 / -1;
                grid-row: 2;
                border-right: none;
                border-bottom: 2px solid #00ffff;
                padding: 25px 20px;
            }

            .plane-visual {
                grid-column: 1 / -1;
                grid-row: 3;
                border-right: none;
                border-bottom: 2px solid #00ffff;
                padding: 25px 20px;
            }

            .tower-section {
                grid-column: 1 / -1;
                grid-row: 4;
                border-right: none;
                border-bottom: 2px solid #00ffff;
                padding: 25px 20px;
            }
            
            .weapons-section {
                grid-column: 1 / -1;
                grid-row: 5;
                border-right: none;
                border-bottom: none;
                padding: 25px 20px;
            }
            
            .section-title-large {
                font-size: 2rem;
            }
            
            .slots-grid {
                grid-template-columns: repeat(4, 1fr);
                gap: 10px;
            }
        }

        /* Âπ≥ÊùøÁõ¥Âêë/Â§ßÊâãÊ©üÔºà481px - 768pxÔºâ*/
        @media (max-width: 768px) {
            .shop-btn {
                padding: 8px 16px;
                font-size: 0.85rem;
                left: 10px;
            }
            
            .slots-grid {
                /* ÊîπÁî® Flexbox ÈÅøÂÖçÈáçÁñä */
                display: flex;
                flex-wrap: wrap;
                justify-content: center;
                gap: 10px;
            }
            
            .slot {
                /* ÊØèË°åÊúÄÂ§ö2ÂÄãÊßΩ‰Ωç */
                flex: 0 0 calc(50% - 5px);
                max-width: calc(50% - 5px);
                min-width: 140px;
                aspect-ratio: 1;
                padding: 10px;
            }
            
            .plane-info,
            .plane-visual,
            .tower-section,
            .weapons-section {
                padding: 20px 15px;
            }
            
            .section-title-large {
                font-size: 1.7rem;
                letter-spacing: 3px;
            }
            
            .slot-icon {
                font-size: 35px;
            }
            
            .slot-name {
                font-size: 0.75rem;
            }
            
            .slot-empty-icon {
                font-size: 35px;
            }
            
            .plane-image {
                max-width: 280px;
            }
            
            .plane-stats {
                gap: 20px;
                padding: 18px;
            }
            
            .progress-block {
                width: 22px;
                height: 16px;
            }
        }

        /* ÊôÆÈÄöÊâãÊ©üÔºà< 480pxÔºâ*/
        @media (max-width: 480px) {
            body {
                padding: 5px;
            }
            
            .main-container {
                border-radius: 8px;
            }
            
            .shop-btn {
                padding: 6px 12px;
                font-size: 0.75rem;
                gap: 4px;
            }
            
            .header-title {
                font-size: 1.4rem;
                padding: 10px 25px;
                letter-spacing: 2px;
            }
            
            .close-btn {
                width: 35px;
                height: 35px;
                right: 10px;
            }
            
            .plane-info,
            .plane-visual,
            .tower-section,
            .weapons-section {
                padding: 18px 12px;
            }
            
            .section-title-large {
                font-size: 1.4rem;
                letter-spacing: 1px;
                margin-bottom: 15px;
            }
            
            .slots-grid {
                /* ÊîπÁî® Flexbox ÈÅøÂÖçÈáçÁñä */
                display: flex;
                flex-wrap: wrap;
                justify-content: center;
                gap: 8px;
            }
            
            .slot {
                /* ÊØèË°åÊúÄÂ§ö2ÂÄãÊßΩ‰Ωç */
                flex: 0 0 calc(50% - 4px);
                max-width: calc(50% - 4px);
                min-width: 120px;
                aspect-ratio: 1;
                padding: 8px;
            }
            
            .slot-icon {
                font-size: 30px;
            }
            
            .slot-name {
                font-size: 0.65rem;
            }
            
            .slot-empty-icon {
                font-size: 30px;
            }
            
            .plane-image {
                max-width: 220px;
            }
            
            .plane-stats {
                flex-direction: column;
                gap: 10px;
                padding: 12px;
            }
            
            .progress-block {
                width: 18px;
                height: 14px;
            }
            
            .attribute-icon {
                font-size: 28px;
                width: 38px;
                height: 38px;
            }
            
            .attribute-label {
                font-size: 0.8rem;
            }
            
            .upgrade-plus-btn {
                width: 28px;
                height: 28px;
                font-size: 1.1rem;
            }
        }

        /* Ë∂ÖÂ§ßËû¢ÂπïÔºà> 1600pxÔºâ*/
        @media (min-width: 1601px) {
            body {
                padding: 40px;
            }
            
            .main-container {
                max-width: 1200px;
                min-height: 1000px;
            }
        }

        /* ÈñãÂßãÈÅäÊà≤ÊåâÈàïÂÆπÂô® - Âú®Á∂≤Ê†ºÂ∫ïÈÉ®Â±Ö‰∏≠ */
        .start-game-container {
            grid-column: 1 / -1;  /* Ë∑®Ë∂äÊâÄÊúâ12Âàó */
            display: flex;
            justify-content: center;  /* Â±Ö‰∏≠Â∞çÈΩä */
            align-items: center;
            padding: 40px 20px;
        }

        .start-game-btn {
            padding: 20px 80px;
            background: linear-gradient(135deg, #ffd93d 0%, #ffac10 100%);
            border: 3px solid #ffffff;
            border-radius: 50px;
            font-family: 'Orbitron', monospace;
            font-size: 1.5rem;
            font-weight: 900;
            color: #000000;
            cursor: pointer;
            box-shadow: 0 0 40px rgba(255, 217, 61, 0.8);
            transition: all 0.3s ease;
            text-transform: uppercase;
            letter-spacing: 3px;
        }

        .start-game-btn:hover {
            transform: translateY(-5px) scale(1.08);
            box-shadow: 0 10px 50px rgba(255, 217, 61, 1);
            background: linear-gradient(135deg, #ffed4e 0%, #ffc221 100%);
        }

        .start-game-btn:active {
            transform: translateY(-2px) scale(1.05);
        }

        @media (max-width: 768px) {
            .start-game-container {
                padding: 30px 20px;
            }

            .start-game-btn {
                padding: 18px 60px;
                font-size: 1.3rem;
            }
        }

        @media (max-width: 480px) {
            .start-game-container {
                padding: 25px 15px;
            }

            .start-game-btn {
                padding: 15px 40px;
                font-size: 1.1rem;
                letter-spacing: 2px;
            }
        }
    </style>
</head>
<body>
    <div class="main-container">
        <!-- È†ÇÈÉ®Ê®ôÈ°åÂçÄ -->
        <div class="header-bar">
            <!-- üõí ÂïÜÂ∫óÊåâÈàï -->
            <button class="shop-btn" onclick="goToShop()">
                üõí ÂïÜÂ∫ó
            </button>
          
            <div class="header-title">
                <div class="header-stoke-left"></div>
                ÊàëÁöÑÊà∞Ê©ü
                <div class="header-stoke-right"></div>
            </div>

            <button class="close-btn" onclick="window.close()">‚úï</button>
        </div>

        <!-- Â∑¶‰∏äÂçÄ - MY AIR PLANE -->
        <div class="plane-info">
            <!-- üÜï Êà∞Ê©üÂêçÁ®±ÂçÄÂ°ä -->
            <div class="ship-name-section">
                <div class="small-title">Your Spaceship Name</div>
                <h1 class="my-ship-name" id="ship-name">MY AIR PLANE</h1>
                <button class="change-name-btn" onclick="changeName()">CHANGE NAME</button>
            </div>

            <!-- üÜï ÂçáÁ¥öÊäÄËÉΩÂçÄÂ°ä -->
            <div class="upgrade-skill-section">
                <div class="small-title">Upgrade Skill</div>
                
                <!-- Health Points -->
                <div class="attribute-row">
                    <div class="attribute-icon">‚ù§Ô∏è</div>
                    <div class="attribute-content">
                        <div class="attribute-label">Health Points</div>
                        <div class="progress-container">
                            <div class="progress-blocks" id="health-progress">
                                <!-- 10 ÂÄãÊñπÊ†ºÂ∞áÁî± JS ÁîüÊàê -->
            </div>
                            <button class="upgrade-plus-btn" id="health-upgrade-btn" onclick="upgradeAttribute('health')">+</button>
            </div>
            </div>
        </div>

                <!-- Speed Points -->
                <div class="attribute-row">
                    <div class="attribute-icon">üëä</div>
                    <div class="attribute-content">
                        <div class="attribute-label">Speed Points</div>
                        <div class="progress-container">
                            <div class="progress-blocks" id="speed-progress">
                                <!-- 10 ÂÄãÊñπÊ†ºÂ∞áÁî± JS ÁîüÊàê -->
                    </div>
                            <button class="upgrade-plus-btn" id="speed-upgrade-btn" onclick="upgradeAttribute('moveSpeed')">+</button>
                        </div>
                        </div>
                    </div>
                        </div>
                </div>

        <!-- Âè≥‰∏äÂçÄ - Êà∞Ê©üÂúñÁâá -->
        <div class="plane-visual">
            <div class="plane-image-container">
                <img src="assets/sprites/ships/blue/Ship_LVL_1.png" alt="ÊàëÁöÑÊà∞Ê©ü" class="plane-image" onerror="this.style.display='none'">
                    </div>
            <div class="plane-stats">
                <div class="plane-stat-item">
                    <div class="plane-stat-label">üí∞ ÈáëÂπ£</div>
                    <div class="plane-stat-value" id="player-money">5000</div>
                        </div>
                <div class="plane-stat-item">
                    <div class="plane-stat-label">üèÜ ÂãùÂ†¥</div>
                    <div class="plane-stat-value" id="wins">0</div>
                        </div>
                <div class="plane-stat-item">
                    <div class="plane-stat-label">üíÄ ÊìäÊÆ∫</div>
                    <div class="plane-stat-value" id="kills">0</div>
                    </div>
                        </div>
                    </div>

        <!-- Â∑¶‰∏ãÂçÄ - MY DEFEND TOWER -->
        <div class="tower-section">
            <h1 class="section-title">MY DEFEND TOWER</h1>
            <div class="equipment-requirement" id="tower-requirement">
                Â∑≤Ë£ùÂÇô: <span id="tower-count">0</span> / 4 (ÊúÄÂ∞ë4Á®Æ)
            </div>
            <div class="slots-grid" id="tower-loadout">
                <!-- 8 ÂÄãÊßΩ‰ΩçÂ∞áÁî± JS ÁîüÊàê -->
            </div>
                </div>

        <!-- Âè≥‰∏ãÂçÄ - MY WEAPONS -->
        <div class="weapons-section">
            <h1 class="section-title">MY WEAPONS</h1>
            <div class="equipment-requirement" id="weapon-requirement">
                Â∑≤Ë£ùÂÇô: <span id="weapon-count">0</span> / 3 (ÊúÄÂ∞ë3Á®Æ)
            </div>
            <div class="slots-grid" id="weapon-loadout">
                <!-- 8 ÂÄãÊßΩ‰ΩçÂ∞áÁî± JS ÁîüÊàê -->
                    </div>
                        </div>

        <!-- ÈñãÂßãÈÅäÊà≤ÊåâÈàï -->
        <div class="start-game-container">
            <button class="start-game-btn" onclick="startGame()" disabled>
                üéÆ ÈñãÂßãÈÅäÊà≤
            </button>
        </div>
                        </div>

    <!-- Ê≠¶Âô®ÈÅ∏ÊìáÂ∞çË©±Ê°Ü -->
    <div id="weapon-dialog" class="dialog-overlay">
        <div class="dialog-box">
            <button class="dialog-close" onclick="closeWeaponDialog()">‚úï</button>
            <!-- <div class="dialog-header">
                <h3 class="dialog-title">üî´ ÈÅ∏ÊìáÊ≠¶Âô®</h3>
            </div> -->
            <div class="dialog-content" id="weapon-options">
                <!-- Ê≠¶Âô®ÈÅ∏È†ÖÂ∞áÁî± JavaScript ÂãïÊÖãÁîüÊàê -->
                    </div>
            <div class="dialog-footer">
                <button class="dialog-btn dialog-btn-secondary" onclick="closeWeaponDialog()">ÂèñÊ∂à</button>
                <button class="dialog-btn dialog-btn-primary" onclick="confirmWeaponSelection()">Á¢∫Ë™ç</button>
                        </div>
                    </div>
                </div>

    <!-- ÁÇÆÂ°îÈÅ∏ÊìáÂ∞çË©±Ê°Ü -->
    <div id="tower-dialog" class="dialog-overlay">
        <div class="dialog-box">
            <button class="dialog-close" onclick="closeTowerDialog()">‚úï</button>
            <!-- <div class="dialog-header">
                <h3 class="dialog-title">üèóÔ∏è ÈÅ∏ÊìáÁÇÆÂ°î</h3>
            </div> -->
            <div class="dialog-content" id="tower-options">
                <!-- ÁÇÆÂ°îÈÅ∏È†ÖÂ∞áÁî± JavaScript ÂãïÊÖãÁîüÊàê -->
                    </div>
            <div class="dialog-footer">
                <button class="dialog-btn dialog-btn-secondary" onclick="closeTowerDialog()">ÂèñÊ∂à</button>
                <button class="dialog-btn dialog-btn-primary" onclick="confirmTowerSelection()">Á¢∫Ë™ç</button>
                        </div>
                        </div>
                    </div>

    <script>
        // ===== ÈÖçÁΩÆÊï∏Êìö =====
        const WEAPON_DATA = {
            vulcan: {
                id: 'vulcan',
                name: 'Vulcan',
                icon: 'üî´',
                description: 'Âø´ÈÄüÈÄ£ÁôºÊ©üÊßç',
                damage: 20,
                ammo: '‚àû',
                fireRate: 150,
                unlocked: true
            },
            missile: {
                id: 'missile',
                name: 'Missile',
                icon: 'üöÄ',
                description: 'ËøΩËπ§Êïµ‰∫∫ÁöÑÂ∞éÂΩà',
                damage: 100,
                ammo: 3,
                cooldown: 5,
                unlocked: true
            },
            bomb: {
                id: 'bomb',
                name: 'Bomb',
                icon: 'üí£',
                description: 'Â§ßÁØÑÂúçÁàÜÁÇ∏ÁÇ∏ÂΩà',
                damage: 200,
                ammo: 1,
                cooldown: 10,
                unlocked: true
            }
        };

        const TOWER_DATA = {
            basic: {
                id: 'basic',
                name: 'Gatling',
                icon: 'üéØ',
                description: 'Âø´ÈÄüÂ∞ÑÊìäÁÇÆÂ°î',
                damage: 25,
                uses: 5,
                range: 120,
                unlocked: true
            },
            cannon: {
                id: 'cannon',
                name: 'Striker',
                icon: 'üí•',
                description: 'ÁØÑÂúçÁàÜÁÇ∏ÂÇ∑ÂÆ≥',
                damage: 80,
                uses: 5,
                range: 100,
                unlocked: true
            },
            laser: {
                id: 'laser',
                name: 'Railgun',
                icon: '‚ö°',
                description: 'È´òÁ≤æÊ∫ñËÉΩÈáèÊ≠¶Âô®',
                damage: 40,
                uses: 5,
                range: 150,
                unlocked: true
            },
            ice: {
                id: 'ice',
                name: 'Frost',
                icon: '‚ùÑÔ∏è',
                description: 'Ê∏õÁ∑©Êïµ‰∫∫ÈÄüÂ∫¶',
                damage: 20,
                uses: 5,
                range: 130,
                unlocked: true
            }
        };

        // ===== ÂÖ®Â±ÄÁãÄÊÖã =====
        let currentLoadout = {
            weapons: ['vulcan', 'missile', 'bomb'],
            towers: ['basic', 'cannon', 'laser']
        };

        let currentEditingSlot = null;
        let currentEditingType = null;
        let tempSelection = null;

        // ===== ÂàùÂßãÂåñ =====
        function init() {
            loadSavedLoadout();
            initializeUpgrades();
            renderProgressBars();
            loadShipName();  // üÜï ËºâÂÖ•Êà∞Ê©üÂêçÁ®±
            renderWeaponLoadout();
            renderTowerLoadout();
            loadPlayerData();
            checkEquipmentRequirements();  // üÜï Ê™¢Êü•Ë£ùÂÇôË¶ÅÊ±Ç
        }

        // ===== üÜï ÂàùÂßãÂåñÂçáÁ¥öÊï∏Êìö =====
        function initializeUpgrades() {
            const config = JSON.parse(localStorage.getItem('playerShipConfig') || '{}');
            
            if (!config.upgrades) {
                config.upgrades = {
                    health: {
                        level: 0,
                        baseValue: 5,
                        currentValue: 5,
                        costPerLevel: 300,
                        incrementPerLevel: 1,
                        unit: 'HP',
                        maxLevel: 10
                    },
                    moveSpeed: {
                        level: 0,
                        baseValue: 300,
                        currentValue: 300,
                        costPerLevel: 350,
                        incrementPerLevel: 50,
                        unit: 'ÂÉèÁ¥†/Áßí',
                        maxLevel: 10
                    }
                };
            }
            
            if (!config.playerMoney) {
                config.playerMoney = 5000;
            }
            
            // üÜï ÂàùÂßãÂåñÊà∞Ê©üÂêçÁ®±
            if (!config.shipName) {
                config.shipName = 'MY AIR PLANE';  // È†êË®≠ÂêçÁ®±
            }
            
            localStorage.setItem('playerShipConfig', JSON.stringify(config));
            console.log('‚úÖ ÂçáÁ¥öÁ≥ªÁµ±ÂàùÂßãÂåñÂÆåÊàê');
        }

        // ===== üÜï Ê∏≤ÊüìÈÄ≤Â∫¶Ê¢ù =====
        function renderProgressBars() {
            const config = JSON.parse(localStorage.getItem('playerShipConfig') || '{}');
            
            // Ê∏≤Êüì Health ÈÄ≤Â∫¶Ê¢ù
            const healthProgress = document.getElementById('health-progress');
            healthProgress.innerHTML = '';
            const healthLevel = config.upgrades?.health?.level || 0;
            for (let i = 0; i < 10; i++) {
                const block = document.createElement('div');
                block.className = 'progress-block' + (i < healthLevel ? ' active health' : '');
                healthProgress.appendChild(block);
            }
            
            // Ê∏≤Êüì Speed ÈÄ≤Â∫¶Ê¢ù
            const speedProgress = document.getElementById('speed-progress');
            speedProgress.innerHTML = '';
            const speedLevel = config.upgrades?.moveSpeed?.level || 0;
            for (let i = 0; i < 10; i++) {
                const block = document.createElement('div');
                block.className = 'progress-block' + (i < speedLevel ? ' active speed' : '');
                speedProgress.appendChild(block);
            }
            
            // Êõ¥Êñ∞ÂçáÁ¥öÊåâÈàïÁãÄÊÖã
            updateUpgradeButtons();
        }

        // ===== üÜï Êõ¥Êñ∞ÂçáÁ¥öÊåâÈàïÁãÄÊÖã =====
        function updateUpgradeButtons() {
            const config = JSON.parse(localStorage.getItem('playerShipConfig') || '{}');
            
            // Health ÂçáÁ¥öÊåâÈàï
            const healthBtn = document.getElementById('health-upgrade-btn');
            const healthUpgrade = config.upgrades?.health;
            if (healthUpgrade) {
                const cost = Math.floor(healthUpgrade.costPerLevel * Math.pow(1.2, healthUpgrade.level));
                const canAfford = config.playerMoney >= cost;
                const isMaxLevel = healthUpgrade.level >= (healthUpgrade.maxLevel || 10);
                healthBtn.disabled = !canAfford || isMaxLevel;
                healthBtn.title = isMaxLevel ? 'Â∑≤ÈÅîÊúÄÈ´òÁ≠âÁ¥ö' : `ÂçáÁ¥öÈúÄË¶Å ${cost} ÈáëÂπ£`;
            }
            
            // Speed ÂçáÁ¥öÊåâÈàï
            const speedBtn = document.getElementById('speed-upgrade-btn');
            const speedUpgrade = config.upgrades?.moveSpeed;
            if (speedUpgrade) {
                const cost = Math.floor(speedUpgrade.costPerLevel * Math.pow(1.2, speedUpgrade.level));
                const canAfford = config.playerMoney >= cost;
                const isMaxLevel = speedUpgrade.level >= (speedUpgrade.maxLevel || 10);
                speedBtn.disabled = !canAfford || isMaxLevel;
                speedBtn.title = isMaxLevel ? 'Â∑≤ÈÅîÊúÄÈ´òÁ≠âÁ¥ö' : `ÂçáÁ¥öÈúÄË¶Å ${cost} ÈáëÂπ£`;
            }
        }

        // ===== üÜï ÂçáÁ¥öÂ±¨ÊÄß =====
        function upgradeAttribute(attributeName) {
            const config = JSON.parse(localStorage.getItem('playerShipConfig'));
            const upgrade = config.upgrades[attributeName];
            
            if (!upgrade) {
                console.error('ÂçáÁ¥ö‰∏çÂ≠òÂú®:', attributeName);
                return;
            }
            
            // Ê™¢Êü•ÊòØÂê¶Â∑≤ÈÅîÊúÄÈ´òÁ≠âÁ¥ö
            if (upgrade.level >= (upgrade.maxLevel || 10)) {
                alert('Â∑≤ÈÅîÊúÄÈ´òÁ≠âÁ¥öÔºÅ');
                return;
            }
            
            // Ë®àÁÆóÁï∂ÂâçÁ≠âÁ¥öÁöÑÂçáÁ¥öÊàêÊú¨
            const currentCost = Math.floor(upgrade.costPerLevel * Math.pow(1.2, upgrade.level));
            
            // Ê™¢Êü•ÈáëÂπ£ÊòØÂê¶Ë∂≥Â§†
            if (config.playerMoney < currentCost) {
                alert(`ÈáëÂπ£‰∏çË∂≥ÔºÅ\n\nÈúÄË¶Å: ${currentCost} ÈáëÂπ£\nÁï∂Ââç: ${config.playerMoney} ÈáëÂπ£`);
                return;
            }
            
            // Êâ£Èô§ÈáëÂπ£
            config.playerMoney -= currentCost;
            
            // ÂçáÁ¥ö
            upgrade.level++;
            upgrade.currentValue = upgrade.baseValue + (upgrade.incrementPerLevel * upgrade.level);
            
            // ‰øùÂ≠ò
            localStorage.setItem('playerShipConfig', JSON.stringify(config));
            
            // ÈáçÊñ∞Ê∏≤Êüì
            updatePlayerMoneyDisplay();
            renderProgressBars();
            
            const attributeNames = {
                health: 'ÁîüÂëΩÂÄº',
                moveSpeed: 'ÁßªÂãïÈÄüÂ∫¶'
            };
            
            console.log(`‚úÖ ${attributeNames[attributeName]} ÂçáÁ¥öÂà∞ Lv.${upgrade.level}ÔºåÊñ∞Êï∏ÂÄº: ${upgrade.currentValue} ${upgrade.unit}`);
        }

        // ===== Ê∏≤ÊüìÊ≠¶Âô®Ë£ùÂÇôÊßΩÔºà8ÂÄãÔºâ =====
        function renderWeaponLoadout() {
            const container = document.getElementById('weapon-loadout');
            container.innerHTML = '';
            
            // Áç≤ÂèñÊâÄÊúâÂèØÁî®Ê≠¶Âô®
            const allWeapons = Object.values(WEAPON_DATA).filter(w => w.unlocked);
            
            // ÁîüÊàê 8 ÂÄãÊßΩ‰Ωç
            for (let i = 0; i < 8; i++) {
                const equippedWeaponId = currentLoadout.weapons[i];
                
                // Ê±∫ÂÆöË¶ÅÈ°ØÁ§∫‰ªÄÈ∫º
                let weapon = null;
                let isEquipped = false;
                
                if (equippedWeaponId) {
                    // Â∑≤Ë£ùÂÇôÁöÑÊ≠¶Âô®
                    weapon = WEAPON_DATA[equippedWeaponId];
                    isEquipped = true;
                } else if (i - 3 >= 0 && i - 3 < allWeapons.length) {
                    // Êú™Ë£ùÂÇô‰ΩÜÂèØÁî®ÁöÑÊ≠¶Âô®ÔºàÂæûÁ¨¨4ÂÄãÊßΩ‰ΩçÈñãÂßãÈ°ØÁ§∫ÂÖ∂‰ªñÊ≠¶Âô®Ôºâ
                    weapon = allWeapons[i - 3];
                    // Á¢∫‰øù‰∏çÈáçË§áÈ°ØÁ§∫Â∑≤Ë£ùÂÇôÁöÑÊ≠¶Âô®
                    if (currentLoadout.weapons.includes(weapon.id)) {
                        // Ë∑≥ÈÅéÂ∑≤Ë£ùÂÇôÁöÑÔºåÊâæ‰∏ã‰∏ÄÂÄã
                        const availableWeapons = allWeapons.filter(w => !currentLoadout.weapons.includes(w.id));
                        const index = i - 3 - currentLoadout.weapons.filter(w => w).length;
                        weapon = availableWeapons[index] || null;
                    }
                }
                
                if (weapon) {
                    const slotHTML = `
                        <div class="slot ${isEquipped ? 'equipped' : 'available'}" 
                             onclick="showWeaponDetails('${weapon.id}', ${i})"
                             data-weapon-id="${weapon.id}">
                            ${isEquipped ? '<div class="slot-tick">‚úì</div>' : ''}
                            <div class="slot-icon">${weapon.icon}</div>
                            <div class="slot-name">${weapon.name}</div>
                        </div>
                    `;
                    container.innerHTML += slotHTML;
                } else {
                    // Á©∫ÊßΩ‰Ωç
                    const emptySlotHTML = `
                        <div class="slot empty">
                            <div class="slot-empty-icon">‚¨°</div>
                    </div>
                    `;
                    container.innerHTML += emptySlotHTML;
                }
            }
            
            // üÜï Ê∏≤ÊüìÂÆåÊàêÂæåÊ™¢Êü•Ë£ùÂÇô
            checkEquipmentRequirements();
        }

        // ===== Ê∏≤ÊüìÁÇÆÂ°îË£ùÂÇôÊßΩÔºà8ÂÄãÔºâ =====
        function renderTowerLoadout() {
            const container = document.getElementById('tower-loadout');
            container.innerHTML = '';
            
            // Áç≤ÂèñÊâÄÊúâÂèØÁî®ÁÇÆÂ°î
            const allTowers = Object.values(TOWER_DATA).filter(t => t.unlocked);
            
            // ÁîüÊàê 8 ÂÄãÊßΩ‰Ωç
            for (let i = 0; i < 8; i++) {
                const equippedTowerId = currentLoadout.towers[i];
                
                // Ê±∫ÂÆöË¶ÅÈ°ØÁ§∫‰ªÄÈ∫º
                let tower = null;
                let isEquipped = false;
                
                if (equippedTowerId) {
                    // Â∑≤Ë£ùÂÇôÁöÑÁÇÆÂ°î
                    tower = TOWER_DATA[equippedTowerId];
                    isEquipped = true;
                } else {
                    // Êú™Ë£ùÂÇô‰ΩÜÂèØÁî®ÁöÑÁÇÆÂ°îÔºàÈ°ØÁ§∫ÂÖ∂‰ªñÁÇÆÂ°îÔºâ
                    const availableTowers = allTowers.filter(t => !currentLoadout.towers.includes(t.id));
                    const equippedCount = currentLoadout.towers.filter(t => t).length;
                    const index = i - equippedCount;
                    tower = availableTowers[index] || null;
                }
                
                if (tower) {
                    const slotHTML = `
                        <div class="slot ${isEquipped ? 'equipped' : 'available'}" 
                             onclick="showTowerDetails('${tower.id}', ${i})"
                             data-tower-id="${tower.id}">
                            ${isEquipped ? '<div class="slot-tick">‚úì</div>' : ''}
                            <div class="slot-icon">${tower.icon}</div>
                            <div class="slot-name">${tower.name}</div>
                </div>
                    `;
                    container.innerHTML += slotHTML;
                } else {
                    // Á©∫ÊßΩ‰Ωç
                    const emptySlotHTML = `
                        <div class="slot empty">
                            <div class="slot-empty-icon">‚¨°</div>
                        </div>
                    `;
                    container.innerHTML += emptySlotHTML;
                }
            }
            
            // üÜï Ê∏≤ÊüìÂÆåÊàêÂæåÊ™¢Êü•Ë£ùÂÇô
            checkEquipmentRequirements();
        }

        // ===== ËÆÄÂèñ‰øùÂ≠òÁöÑÈÖçÁΩÆ =====
        function loadSavedLoadout() {
            const saved = localStorage.getItem('playerShipConfig');
            if (saved) {
                try {
                    const config = JSON.parse(saved);
                    if (config.weaponSlots) {
                        currentLoadout.weapons = config.weaponSlots.map(slot => slot.weaponId);
                    }
                    if (config.towerSlots) {
                        currentLoadout.towers = config.towerSlots.map(slot => slot.towerId);
                    }
                } catch (e) {
                    console.error('ËºâÂÖ•ÈÖçÁΩÆÂ§±Êïó:', e);
                }
            }
        }

        // ===== ‰øùÂ≠òÈÖçÁΩÆ =====
        function saveLoadout() {
            const config = JSON.parse(localStorage.getItem('playerShipConfig') || '{}');
            
            config.weaponSlots = currentLoadout.weapons
                .filter(w => w) // ÈÅéÊøæÁ©∫ÊßΩ‰Ωç
                .map((weaponId, index) => ({
                    slotId: index,
                    weaponId: weaponId
                }));
            
            config.towerSlots = currentLoadout.towers
                .filter(t => t) // ÈÅéÊøæÁ©∫ÊßΩ‰Ωç
                .map((towerId, index) => ({
                    slotId: index,
                    towerId: towerId,
                    count: 5
                }));
            
            localStorage.setItem('playerShipConfig', JSON.stringify(config));
            console.log('‚úÖ ÈÖçÁΩÆÂ∑≤‰øùÂ≠ò:', config);
        }

        // ===== ÊâìÈñãÊ≠¶Âô®ÈÅ∏ÊìáÂ∞çË©±Ê°Ü =====
        function openWeaponDialog(slotIndex) {
            currentEditingSlot = slotIndex;
            currentEditingType = 'weapon';
            tempSelection = currentLoadout.weapons[slotIndex];
            
            const container = document.getElementById('weapon-options');
            container.innerHTML = '';
            
            Object.values(WEAPON_DATA).forEach(weapon => {
                const isSelected = weapon.id === tempSelection;
                const isEquipped = currentLoadout.weapons.includes(weapon.id);
                
                const optionHTML = `
                    <div class="option-item ${isSelected ? 'selected' : ''} ${!weapon.unlocked ? 'locked' : ''}" 
                         onclick="${weapon.unlocked ? `selectWeapon('${weapon.id}')` : ''}">
                        <div class="option-icon">${weapon.icon}</div>
                        <div class="option-details">
                            <div class="option-name">${weapon.name}</div>
                            <div class="option-desc">${weapon.description}</div>
                            <div class="option-stats">
                                <span>ÂÇ∑ÂÆ≥: ${weapon.damage}</span>
                                <span>ÂΩàËó•: ${weapon.ammo}</span>
                                ${weapon.fireRate ? `<span>Â∞ÑÈÄü: ${weapon.fireRate}ms</span>` : ''}
                    </div>
                        </div>
                        ${isEquipped ? '<span class="option-badge">Â∑≤Ë£ùÂÇô</span>' : ''}
                        ${isSelected ? '<span class="option-badge">‚úì</span>' : ''}
                        ${!weapon.unlocked ? '<span class="option-badge locked">üîí Êú™Ëß£Èéñ</span>' : ''}
                        </div>
                `;
                container.innerHTML += optionHTML;
            });
            
            document.getElementById('weapon-dialog').classList.add('active');
        }

        // ===== ÈÅ∏ÊìáÊ≠¶Âô® =====
        function selectWeapon(weaponId) {
            tempSelection = weaponId;
            
            // Êõ¥Êñ∞ UI ÈÅ∏‰∏≠ÁãÄÊÖã
            document.querySelectorAll('#weapon-options .option-item').forEach(item => {
                item.classList.remove('selected');
            });
            event.currentTarget.classList.add('selected');
        }

        // ===== Á¢∫Ë™çÊ≠¶Âô®ÈÅ∏Êìá =====
        function confirmWeaponSelection() {
            if (tempSelection && currentEditingSlot !== null) {
                currentLoadout.weapons[currentEditingSlot] = tempSelection;
                saveLoadout();
                renderWeaponLoadout();
                closeWeaponDialog();
            }
        }

        // ===== ÈóúÈñâÊ≠¶Âô®Â∞çË©±Ê°Ü =====
        function closeWeaponDialog() {
            const dialog = document.getElementById('weapon-dialog');
            dialog.classList.add('closing');
            
            // Á≠âÂæÖÂãïÁï´ÂÆåÊàêÂæåÂÜçÁßªÈô§
            setTimeout(() => {
                dialog.classList.remove('active', 'closing');
                currentEditingSlot = null;
                tempSelection = null;
            }, 300); // Ëàá CSS ÂãïÁï´ÊôÇÈñì‰∏ÄËá¥
        }

        // ===== üÜï È°ØÁ§∫Ê≠¶Âô®Ë©≥ÊÉÖ =====
        function showWeaponDetails(weaponId, slotIndex) {
            const weapon = WEAPON_DATA[weaponId];
            if (!weapon) return;
            
            const isEquipped = currentLoadout.weapons[slotIndex] === weaponId;
            const equippedSlotIndex = currentLoadout.weapons.indexOf(weaponId);
            
            const container = document.getElementById('weapon-options');
            container.innerHTML = `
                <div class="detail-view">
                    <div class="detail-icon">${weapon.icon}</div>
                    
                    <div class="detail-name-row">
                        <h2 class="detail-name">${weapon.name}</h2>
                        ${isEquipped || equippedSlotIndex !== -1 ? `
                            <div class="detail-status">‚úÖ ÊßΩ‰Ωç ${equippedSlotIndex + 1}</div>
                        ` : `
                            <div class="detail-status unequipped">Êú™Ë£ùÂÇô</div>
                        `}
                    </div>
                    
                    <p class="detail-desc" style="text-align: center; margin-bottom: 20px;">
                        ${weapon.description}
                    </p>
                    
                    <div class="detail-section">
                        <div class="detail-stats" style="flex-direction: row; justify-content: space-around; gap: 20px;">
                            <div class="detail-stat" style="flex: 1;">
                                <span>ÂÇ∑ÂÆ≥</span>
                                <span class="stat-value">${weapon.damage}</span>
                        </div>
                            <div class="detail-stat" style="flex: 1;">
                                <span>ÂÜ∑Âçª</span>
                                <span class="stat-value">${weapon.cooldown || 0} Áßí</span>
                    </div>
                </div>
                    </div>
                        </div>
            `;
            
            // ‰øÆÊîπÂ∞çË©±Ê°ÜÂ∫ïÈÉ®ÊåâÈàï
            const footerEl = document.querySelector('#weapon-dialog .dialog-footer');
            if (isEquipped || equippedSlotIndex !== -1) {
                // Â∑≤Ë£ùÂÇôÔºöÈ°ØÁ§∫Ëß£Èô§ÊåâÈàï
                const actualSlot = equippedSlotIndex !== -1 ? equippedSlotIndex : slotIndex;
                footerEl.innerHTML = `
                    <button class="dialog-btn dialog-btn-secondary" onclick="closeWeaponDialog()">ÈóúÈñâ</button>
                    <button class="dialog-btn dialog-btn-primary" onclick="unequipWeapon(${actualSlot}); closeWeaponDialog();">
                        Ëß£Èô§Ë£ùÂÇô
                    </button>
                `;
            } else {
                // Êú™Ë£ùÂÇôÔºöÈ°ØÁ§∫Ë£ùÂÇôÊåâÈàï
                footerEl.innerHTML = `
                    <button class="dialog-btn dialog-btn-secondary" onclick="closeWeaponDialog()">ÈóúÈñâ</button>
                    <button class="dialog-btn dialog-btn-primary" onclick="equipWeapon('${weaponId}', ${slotIndex}); closeWeaponDialog();">
                        Ë£ùÂÇôÂà∞ÊßΩ‰Ωç ${slotIndex + 1}
                    </button>
                `;
            }
            
            document.getElementById('weapon-dialog').classList.add('active');
        }

        // ===== üÜï Ë£ùÂÇôÊ≠¶Âô® =====
        function equipWeapon(weaponId, slotIndex) {
            currentLoadout.weapons[slotIndex] = weaponId;
            saveLoadout();
            renderWeaponLoadout();
            console.log(`‚úÖ Â∑≤Ë£ùÂÇô ${weaponId} Âà∞ÊßΩ‰Ωç ${slotIndex + 1}`);
        }

        // ===== üÜï Ëß£Èô§Ê≠¶Âô®Ë£ùÂÇô =====
        function unequipWeapon(slotIndex) {
            const weaponId = currentLoadout.weapons[slotIndex];
            currentLoadout.weapons[slotIndex] = null;
            saveLoadout();
            renderWeaponLoadout();
            console.log(`‚ùå Â∑≤Ëß£Èô§ ${weaponId} ÁöÑË£ùÂÇô`);
        }

        // ===== ÊâìÈñãÁÇÆÂ°îÈÅ∏ÊìáÂ∞çË©±Ê°Ü =====
        function openTowerDialog(slotIndex) {
            currentEditingSlot = slotIndex;
            currentEditingType = 'tower';
            tempSelection = currentLoadout.towers[slotIndex];
            
            const container = document.getElementById('tower-options');
            container.innerHTML = '';
            
            Object.values(TOWER_DATA).forEach(tower => {
                const isSelected = tower.id === tempSelection;
                const isEquipped = currentLoadout.towers.includes(tower.id);
                
                const optionHTML = `
                    <div class="option-item ${isSelected ? 'selected' : ''} ${!tower.unlocked ? 'locked' : ''}" 
                         onclick="${tower.unlocked ? `selectTower('${tower.id}')` : ''}">
                        <div class="option-icon">${tower.icon}</div>
                        <div class="option-details">
                            <div class="option-name">${tower.name}</div>
                            <div class="option-desc">${tower.description}</div>
                            <div class="option-stats">
                                <span>ÂÇ∑ÂÆ≥: ${tower.damage}</span>
                                <span>‰ΩøÁî®: √ó${tower.uses}</span>
                                <span>Â∞ÑÁ®ã: ${tower.range}</span>
                        </div>
                    </div>
                        ${isEquipped ? '<span class="option-badge">Â∑≤Ë£ùÂÇô</span>' : ''}
                        ${isSelected ? '<span class="option-badge">‚úì</span>' : ''}
                        ${!tower.unlocked ? '<span class="option-badge locked">üîí Êú™Ëß£Èéñ</span>' : ''}
                        </div>
                `;
                container.innerHTML += optionHTML;
            });
            
            document.getElementById('tower-dialog').classList.add('active');
        }

        // ===== ÈÅ∏ÊìáÁÇÆÂ°î =====
        function selectTower(towerId) {
            tempSelection = towerId;
            
            // Êõ¥Êñ∞ UI ÈÅ∏‰∏≠ÁãÄÊÖã
            document.querySelectorAll('#tower-options .option-item').forEach(item => {
                item.classList.remove('selected');
            });
            event.currentTarget.classList.add('selected');
        }

        // ===== Á¢∫Ë™çÁÇÆÂ°îÈÅ∏Êìá =====
        function confirmTowerSelection() {
            if (tempSelection && currentEditingSlot !== null) {
                currentLoadout.towers[currentEditingSlot] = tempSelection;
                saveLoadout();
                renderTowerLoadout();
                closeTowerDialog();
            }
        }

        // ===== ÈóúÈñâÁÇÆÂ°îÂ∞çË©±Ê°Ü =====
        function closeTowerDialog() {
            const dialog = document.getElementById('tower-dialog');
            dialog.classList.add('closing');
            
            // Á≠âÂæÖÂãïÁï´ÂÆåÊàêÂæåÂÜçÁßªÈô§
            setTimeout(() => {
                dialog.classList.remove('active', 'closing');
                currentEditingSlot = null;
                tempSelection = null;
            }, 300); // Ëàá CSS ÂãïÁï´ÊôÇÈñì‰∏ÄËá¥
        }

        // ===== üÜï È°ØÁ§∫ÁÇÆÂ°îË©≥ÊÉÖ =====
        function showTowerDetails(towerId, slotIndex) {
            const tower = TOWER_DATA[towerId];
            if (!tower) return;
            
            const isEquipped = currentLoadout.towers[slotIndex] === towerId;
            const equippedSlotIndex = currentLoadout.towers.indexOf(towerId);
            
            const container = document.getElementById('tower-options');
            container.innerHTML = `
                <div class="detail-view">
                    <div class="detail-icon">${tower.icon}</div>
                    
                    <div class="detail-name-row">
                        <h2 class="detail-name">${tower.name}</h2>
                        ${isEquipped || equippedSlotIndex !== -1 ? `
                            <div class="detail-status">‚úÖ ÊßΩ‰Ωç ${equippedSlotIndex + 1}</div>
                        ` : `
                            <div class="detail-status unequipped">Êú™Ë£ùÂÇô</div>
                        `}
                    </div>
                    
                    <p class="detail-desc" style="text-align: center; margin-bottom: 20px;">
                        ${tower.description}
                    </p>
                    
                    <div class="detail-section">
                        <div class="detail-stats" style="flex-direction: row; justify-content: space-around; gap: 20px;">
                            <div class="detail-stat" style="flex: 1;">
                                <span>ÂÇ∑ÂÆ≥</span>
                                <span class="stat-value">${tower.damage}</span>
                </div>
                            <div class="detail-stat" style="flex: 1;">
                                <span>Â∞ÑÁ®ã</span>
                                <span class="stat-value">${tower.range}</span>
            </div>
        </div>
    </div>
                </div>
            `;
            
            // ‰øÆÊîπÂ∞çË©±Ê°ÜÂ∫ïÈÉ®ÊåâÈàï
            const footerEl = document.querySelector('#tower-dialog .dialog-footer');
            if (isEquipped || equippedSlotIndex !== -1) {
                // Â∑≤Ë£ùÂÇôÔºöÈ°ØÁ§∫Ëß£Èô§ÊåâÈàï
                const actualSlot = equippedSlotIndex !== -1 ? equippedSlotIndex : slotIndex;
                footerEl.innerHTML = `
                    <button class="dialog-btn dialog-btn-secondary" onclick="closeTowerDialog()">ÈóúÈñâ</button>
                    <button class="dialog-btn dialog-btn-primary" onclick="unequipTower(${actualSlot}); closeTowerDialog();">
                        Ëß£Èô§Ë£ùÂÇô
                    </button>
                `;
            } else {
                // Êú™Ë£ùÂÇôÔºöÈ°ØÁ§∫Ë£ùÂÇôÊåâÈàï
                footerEl.innerHTML = `
                    <button class="dialog-btn dialog-btn-secondary" onclick="closeTowerDialog()">ÈóúÈñâ</button>
                    <button class="dialog-btn dialog-btn-primary" onclick="equipTower('${towerId}', ${slotIndex}); closeTowerDialog();">
                        Ë£ùÂÇôÂà∞ÊßΩ‰Ωç ${slotIndex + 1}
                    </button>
                `;
            }
            
            document.getElementById('tower-dialog').classList.add('active');
        }

        // ===== üÜï Ë£ùÂÇôÁÇÆÂ°î =====
        function equipTower(towerId, slotIndex) {
            currentLoadout.towers[slotIndex] = towerId;
            saveLoadout();
            renderTowerLoadout();
            console.log(`‚úÖ Â∑≤Ë£ùÂÇô ${towerId} Âà∞ÊßΩ‰Ωç ${slotIndex + 1}`);
        }

        // ===== üÜï Ëß£Èô§ÁÇÆÂ°îË£ùÂÇô =====
        function unequipTower(slotIndex) {
            const towerId = currentLoadout.towers[slotIndex];
            currentLoadout.towers[slotIndex] = null;
            saveLoadout();
            renderTowerLoadout();
            console.log(`‚ùå Â∑≤Ëß£Èô§ ${towerId} ÁöÑË£ùÂÇô`);
        }

        // ===== üÜï ËºâÂÖ•Êà∞Ê©üÂêçÁ®± =====
        function loadShipName() {
            const config = JSON.parse(localStorage.getItem('playerShipConfig') || '{}');
            const shipName = config.shipName || 'MY AIR PLANE';
            const shipNameEl = document.getElementById('ship-name');
            if (shipNameEl) {
                shipNameEl.textContent = shipName;
            }
        }

        // ===== üÜï Êõ¥Êñ∞ÈáëÂπ£È°ØÁ§∫ =====
        function updatePlayerMoneyDisplay() {
            const config = JSON.parse(localStorage.getItem('playerShipConfig') || '{}');
            document.getElementById('player-money').textContent = config.playerMoney || 5000;
        }

        // ===== ËÆÄÂèñÁé©ÂÆ∂Êï∏Êìö =====
        function loadPlayerData() {
            updatePlayerMoneyDisplay();
            
            const savedData = localStorage.getItem('playerData');
            if (savedData) {
                try {
                const data = JSON.parse(savedData);
                    document.getElementById('wins').textContent = data.wins || 0;
                    document.getElementById('kills').textContent = data.kills || 0;
                } catch (e) {
                    console.error('ËºâÂÖ•Áé©ÂÆ∂Êï∏ÊìöÂ§±Êïó:', e);
                }
            }
        }

        // ===== üÜï ÊîπÂêçÂäüËÉΩ =====
        function changeName() {
            const config = JSON.parse(localStorage.getItem('playerShipConfig') || '{}');
            const currentName = config.shipName || 'MY AIR PLANE';
            
            const newName = prompt('Ë´ãËº∏ÂÖ•Êñ∞ÁöÑÊà∞Ê©üÂêçÁ®±ÔºàÊúÄÂ§ö 20 ÂÄãÂ≠óÔºâÔºö', currentName);
            
            if (newName && newName.trim()) {
                const trimmedName = newName.trim();
                
                // È©óË≠âÈï∑Â∫¶
                if (trimmedName.length > 20) {
                    alert('ÂêçÁ®±Â§™Èï∑ÔºÅË´ãËº∏ÂÖ• 20 ÂÄãÂ≠ó‰ª•ÂÖßÁöÑÂêçÁ®±„ÄÇ');
                    return;
                }
                
                // È©óË≠â‰∏çËÉΩÁÇ∫Á©∫
                if (trimmedName.length === 0) {
                    alert('ÂêçÁ®±‰∏çËÉΩÁÇ∫Á©∫ÔºÅ');
                    return;
                }
                
                // ‰øùÂ≠òÂà∞ localStorageÔºàËΩâÂ§ßÂØ´‰øùÊåÅÈ¢®Ê†º‰∏ÄËá¥Ôºâ
                config.shipName = trimmedName.toUpperCase();
                localStorage.setItem('playerShipConfig', JSON.stringify(config));
                
                // Êõ¥Êñ∞È°ØÁ§∫
                document.getElementById('ship-name').textContent = config.shipName;
                
                console.log('‚úÖ Êà∞Ê©üÂêçÁ®±Â∑≤Êõ¥ÊîπÁÇ∫:', config.shipName);
            }
        }

        // ===== ÂâçÂæÄÂïÜÂ∫ó =====
        function goToShop(category = '') {
            // ‰øùÂ≠òÁï∂ÂâçÈ†ÅÈù¢‰æÜÊ∫êÔºåÊñπ‰æøËøîÂõû
            localStorage.setItem('returnTo', 'my-ship');
            
            // Â¶ÇÊûúÊåáÂÆö‰∫ÜÂàÜÈ°ûÔºå‰øùÂ≠òÂà∞ localStorage
            if (category) {
                localStorage.setItem('shopCategory', category);
            }
            
            console.log('üõí ÂâçÂæÄÂïÜÂ∫ó...');
            
            // Ë∑≥ËΩâÂà∞ÂïÜÂ∫ó
            window.location.href = 'shop.html';
        }

        // ===== È†ÅÈù¢È°ØÁ§∫ÊôÇÂà∑Êñ∞ÔºàÂæûÂïÜÂ∫óËøîÂõûÊôÇÔºâ =====
        window.addEventListener('pageshow', function(event) {
            // Â¶ÇÊûúÊòØÂæûÂÖ∂‰ªñÈ†ÅÈù¢ËøîÂõûÔºàÂ¶ÇÂïÜÂ∫óÔºâ
            if (event.persisted || (window.performance && window.performance.navigation.type === 2)) {
                console.log('üîÑ È†ÅÈù¢ÊÅ¢Âæ©ÔºåÂà∑Êñ∞Êï∏Êìö...');
                loadSavedLoadout();
                renderWeaponLoadout();
                renderTowerLoadout();
                updatePlayerMoneyDisplay();
                renderProgressBars();
            }
        });

        // ===== üÜï Ê™¢Êü•Ë£ùÂÇôË¶ÅÊ±Ç =====
        function checkEquipmentRequirements() {
            const weaponCount = currentLoadout.weapons.filter(w => w).length;
            const towerCount = currentLoadout.towers.filter(t => t).length;
            
            const minWeapons = 3;
            const minTowers = 4;
            
            // Êõ¥Êñ∞Ê≠¶Âô®Ë®àÊï∏È°ØÁ§∫
            const weaponCountEl = document.getElementById('weapon-count');
            const weaponReqEl = document.getElementById('weapon-requirement');
            if (weaponCountEl) {
                weaponCountEl.textContent = weaponCount;
            }
            if (weaponReqEl) {
                weaponReqEl.classList.remove('warning', 'valid');
                if (weaponCount < minWeapons) {
                    weaponReqEl.classList.add('warning');
                } else {
                    weaponReqEl.classList.add('valid');
                }
            }
            
            // Êõ¥Êñ∞ÁÇÆÂ°îË®àÊï∏È°ØÁ§∫
            const towerCountEl = document.getElementById('tower-count');
            const towerReqEl = document.getElementById('tower-requirement');
            if (towerCountEl) {
                towerCountEl.textContent = towerCount;
            }
            if (towerReqEl) {
                towerReqEl.classList.remove('warning', 'valid');
                if (towerCount < minTowers) {
                    towerReqEl.classList.add('warning');
                } else {
                    towerReqEl.classList.add('valid');
                }
            }
            
            // Êõ¥Êñ∞ÈñãÂßãÈÅäÊà≤ÊåâÈàïÁãÄÊÖã
            const startBtn = document.querySelector('.start-game-btn');
            const canStart = weaponCount >= minWeapons && towerCount >= minTowers;
            
            if (startBtn) {
                startBtn.disabled = !canStart;
                if (!canStart) {
                    startBtn.title = `ÈúÄË¶ÅËá≥Â∞ë ${minWeapons} Á®ÆÊ≠¶Âô®Âíå ${minTowers} Á®ÆÁÇÆÂ°îÊâçËÉΩÈñãÂßãÈÅäÊà≤`;
                } else {
                    startBtn.title = 'ÈªûÊìäÈñãÂßãÈÅäÊà≤';
                }
            }
            
            return {
                canStart,
                weaponCount,
                towerCount,
                minWeapons,
                minTowers
            };
        }

        // ===== ÈñãÂßãÈÅäÊà≤ =====
        function startGame() {
            const requirements = checkEquipmentRequirements();
            
            if (!requirements.canStart) {
                let message = 'Ë£ùÂÇô‰∏çË∂≥ÔºåÁÑ°Ê≥ïÈñãÂßãÈÅäÊà≤ÔºÅ\n\n';
                
                if (requirements.weaponCount < requirements.minWeapons) {
                    message += `‚ö†Ô∏è Ê≠¶Âô®: ${requirements.weaponCount}/${requirements.minWeapons} (ÈÇÑÈúÄ ${requirements.minWeapons - requirements.weaponCount} Á®Æ)\n`;
                } else {
                    message += `‚úÖ Ê≠¶Âô®: ${requirements.weaponCount}/${requirements.minWeapons}\n`;
                }
                
                if (requirements.towerCount < requirements.minTowers) {
                    message += `‚ö†Ô∏è ÁÇÆÂ°î: ${requirements.towerCount}/${requirements.minTowers} (ÈÇÑÈúÄ ${requirements.minTowers - requirements.towerCount} Á®Æ)\n`;
                } else {
                    message += `‚úÖ ÁÇÆÂ°î: ${requirements.towerCount}/${requirements.minTowers}\n`;
                }
                
                alert(message);
                return;
            }
            
            // Ë£ùÂÇôË∂≥Â§†ÔºåÈñãÂßãÈÅäÊà≤
            window.location.href = 'index.html';
        }

        // ===== È†ÅÈù¢ËºâÂÖ•ÊôÇÂàùÂßãÂåñ =====
        window.addEventListener('load', init);

        // ===== ÈóúÈñâÂ∞çË©±Ê°ÜÔºàÈªûÊìäËÉåÊôØÔºâ =====
        document.addEventListener('click', function(e) {
            if (e.target.classList.contains('dialog-overlay')) {
                closeWeaponDialog();
                closeTowerDialog();
            }
        });
    </script>
</body>
</html>
