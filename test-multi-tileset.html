<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å¤š Tileset æ¸¬è©¦</title>
    <style>
        body {
            margin: 0;
            padding: 20px;
            background: #222;
            color: white;
            font-family: Arial, sans-serif;
        }
        #game-container {
            border: 2px solid #444;
            margin: 20px 0;
        }
        .info {
            background: #333;
            padding: 10px;
            margin: 10px 0;
            border-radius: 5px;
        }
    </style>
</head>
<body>
    <h1>å¤š Tileset åœ°åœ–åŠ è¼‰æ¸¬è©¦</h1>
    
    <div class="info">
        <h3>æ¸¬è©¦ç›®æ¨™ï¼š</h3>
        <ul>
            <li>âœ… åŠ è¼‰ map1.tmj åœ°åœ–æ–‡ä»¶</li>
            <li>âœ… åŠ è¼‰ ground tileset (world-1.png)</li>
            <li>âœ… åŠ è¼‰ tileset-1 tileset (tileset-1.png)</li>
            <li>âœ… å‰µå»º Backgroundã€Pathã€Obstacles åœ–å±¤</li>
            <li>âœ… é¡¯ç¤ºåœ°åœ–å…§å®¹</li>
        </ul>
    </div>

    <div id="game-container"></div>

    <div class="info">
        <h3>æ§åˆ¶å°æ—¥èªŒï¼š</h3>
        <p>è«‹æ‰“é–‹ç€è¦½å™¨é–‹ç™¼è€…å·¥å…·æŸ¥çœ‹è©³ç´°çš„åŠ è¼‰æ—¥èªŒ</p>
    </div>

    <script src="node_modules/phaser/dist/phaser.min.js"></script>
    <script>
        class MultiTilesetTestScene extends Phaser.Scene {
            constructor() {
                super({ key: 'MultiTilesetTestScene' });
            }

            preload() {
                console.log('ğŸ”„ é–‹å§‹åŠ è¼‰è³‡æº...');
                
                // åŠ è¼‰åœ°åœ–æ–‡ä»¶
                this.load.tilemapTiledJSON('map1', 'assets/maps/map1.tmj');
                
                // åŠ è¼‰ç¬¬ä¸€å€‹ tileset
                this.load.image('ground', 'assets/tilesets/map/world-1.png');
                
                // åŠ è¼‰ç¬¬äºŒå€‹ tileset
                this.load.image('tileset-1', 'assets/tilesets/tileset-1.png');
                
                console.log('ğŸ“ è³‡æºåŠ è¼‰å®Œæˆ');
            }

            create() {
                console.log('ğŸ® é–‹å§‹å‰µå»ºå ´æ™¯...');
                
                // å‰µå»ºåœ°åœ–
                this.tiledMap = this.make.tilemap({ key: 'map1' });
                console.log('ğŸ—ºï¸ åœ°åœ–å‰µå»ºæˆåŠŸ:', this.tiledMap);
                
                // é¡¯ç¤ºåœ°åœ–ä¿¡æ¯
                console.log('ğŸ“Š åœ°åœ–ä¿¡æ¯:', {
                    width: this.tiledMap.width,
                    height: this.tiledMap.height,
                    tileWidth: this.tiledMap.tileWidth,
                    tileHeight: this.tiledMap.tileHeight,
                    layers: this.tiledMap.layers.map(layer => layer.name),
                    tilesets: this.tiledMap.tilesets.map(ts => ts.name)
                });
                
                // æ·»åŠ å¤šå€‹ tileset
                const groundTileset = this.tiledMap.addTilesetImage('ground', 'ground');
                console.log('ğŸŸ¢ Ground åœ–å¡Šé›†æ·»åŠ æˆåŠŸ:', groundTileset);
                
                // æª¢æŸ¥ä¸¦æ·»åŠ ç¬¬äºŒå€‹ tileset
                let tileset1 = null;
                try {
                    tileset1 = this.tiledMap.addTilesetImage('tileset-1', 'tileset-1');
                    console.log('ğŸ”µ Tileset-1 åœ–å¡Šé›†æ·»åŠ æˆåŠŸ:', tileset1);
                } catch (error) {
                    console.warn('âš ï¸ Tileset-1 æ·»åŠ å¤±æ•—ï¼Œå°‡åªä½¿ç”¨ ground tileset:', error);
                }
                
                // å‰µå»ºæ‰€æœ‰ tileset çš„æ•¸çµ„
                const allTilesets = [groundTileset];
                if (tileset1) {
                    allTilesets.push(tileset1);
                }
                
                console.log('ğŸ“¦ æ‰€æœ‰ tileset:', allTilesets);
                
                // å‰µå»ºåœ–å±¤
                try {
                    this.backgroundLayer = this.tiledMap.createLayer('Background', allTilesets);
                    console.log('ğŸ–¼ï¸ èƒŒæ™¯åœ–å±¤å‰µå»º:', this.backgroundLayer);
                } catch (error) {
                    console.error('âŒ èƒŒæ™¯åœ–å±¤å‰µå»ºå¤±æ•—:', error);
                }
                
                try {
                    this.pathLayer = this.tiledMap.createLayer('Path', allTilesets);
                    console.log('ğŸ›¤ï¸ è·¯å¾‘åœ–å±¤å‰µå»º:', this.pathLayer);
                } catch (error) {
                    console.error('âŒ è·¯å¾‘åœ–å±¤å‰µå»ºå¤±æ•—:', error);
                }
                
                try {
                    this.obstaclesLayer = this.tiledMap.createLayer('Obstacles', allTilesets);
                    console.log('ğŸš§ éšœç¤™ç‰©åœ–å±¤å‰µå»º:', this.obstaclesLayer);
                } catch (error) {
                    console.error('âŒ éšœç¤™ç‰©åœ–å±¤å‰µå»ºå¤±æ•—:', error);
                }
                
                // è¨­ç½®åœ–å±¤æ·±åº¦
                if (this.backgroundLayer) {
                    this.backgroundLayer.setDepth(-100);
                }
                if (this.pathLayer) {
                    this.pathLayer.setDepth(-50);
                }
                if (this.obstaclesLayer) {
                    this.obstaclesLayer.setDepth(-25);
                }
                
                // ç¸®æ”¾åœ°åœ–ä»¥é©æ‡‰å±å¹•
                const scaleX = this.cameras.main.width / (this.tiledMap.widthInPixels);
                const scaleY = this.cameras.main.height / (this.tiledMap.heightInPixels);
                const scale = Math.min(scaleX, scaleY, 1);
                
                this.tiledMap.setScale(scale);
                
                // å±…ä¸­åœ°åœ–
                this.tiledMap.x = (this.cameras.main.width - this.tiledMap.widthInPixels * scale) / 2;
                this.tiledMap.y = (this.cameras.main.height - this.tiledMap.heightInPixels * scale) / 2;
                
                console.log('âœ… åœ°åœ–è¨­ç½®å®Œæˆï¼Œç¸®æ”¾æ¯”ä¾‹:', scale);
                console.log('ğŸ¯ åœ°åœ–ä½ç½®:', { x: this.tiledMap.x, y: this.tiledMap.y });
            }
        }

        const config = {
            type: Phaser.AUTO,
            width: 1280,
            height: 832,
            parent: 'game-container',
            backgroundColor: '#2c3e50',
            scene: MultiTilesetTestScene
        };

        const game = new Phaser.Game(config);
    </script>
</body>
</html>
